<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Tool Executor Arm - OctoLLM Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Distributed AI Architecture for Offensive Security and Developer Tooling - Comprehensive technical documentation covering architecture, API, development, operations, and security.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OctoLLM Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/doublegate/OctoLLM" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/doublegate/OctoLLM/edit/main/docs/src/components/arms/executor-arm.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="tool-executor-arm-sandboxed-command-execution"><a class="header" href="#tool-executor-arm-sandboxed-command-execution">Tool Executor Arm: Sandboxed Command Execution</a></h1>
<p><strong>Components</strong> &gt; <strong>Arms</strong> &gt; Tool Executor Arm</p>
<p><strong>Version</strong>: 1.0
<strong>Technology</strong>: Rust / actix-web
<strong>Cost Tier</strong>: 3 (Medium-High)
<strong>Average Latency</strong>: 0.5-5 seconds
<strong>Status</strong>: Phase 1 Complete</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#security-model">Security Model</a>
<ul>
<li><a href="#capability-based-access-control">Capability-Based Access Control</a></li>
<li><a href="#capability-types">Capability Types</a></li>
</ul>
</li>
<li><a href="#core-functionality">Core Functionality</a>
<ul>
<li><a href="#command-allowlist">Command Allowlist</a></li>
<li><a href="#sandboxed-execution">Sandboxed Execution</a></li>
<li><a href="#resource-limits">Resource Limits</a></li>
</ul>
</li>
<li><a href="#implementation">Implementation</a>
<ul>
<li><a href="#executor-structure">Executor Structure</a></li>
<li><a href="#command-validation">Command Validation</a></li>
<li><a href="#execution-pipeline">Execution Pipeline</a></li>
</ul>
</li>
<li><a href="#api-specification">API Specification</a>
<ul>
<li><a href="#execute-command">Execute Command</a></li>
<li><a href="#response-formats">Response Formats</a></li>
</ul>
</li>
<li><a href="#data-models">Data Models</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#performance-characteristics">Performance Characteristics</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#deployment">Deployment</a>
<ul>
<li><a href="#docker-sandbox">Docker Sandbox</a></li>
<li><a href="#kubernetes-configuration">Kubernetes Configuration</a></li>
</ul>
</li>
<li><a href="#security-considerations">Security Considerations</a></li>
<li><a href="#see-also">See Also</a></li>
</ul>
<hr />
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The Tool Executor Arm is a security-first component that executes external commands, API calls, and scripts in isolated sandboxes with strict capability controls. It provides the system with the ability to interact with external tools while maintaining strong security boundaries.</p>
<h3 id="key-features"><a class="header" href="#key-features">Key Features</a></h3>
<ul>
<li><strong>Capability-Based Access Control</strong>: Fine-grained permissions for command execution</li>
<li><strong>Command Allowlist</strong>: Only pre-approved commands can be executed</li>
<li><strong>Sandbox Isolation</strong>: All executions run in isolated Docker containers</li>
<li><strong>Resource Limits</strong>: Timeouts, memory limits, and CPU restrictions</li>
<li><strong>Provenance Tracking</strong>: Complete audit trail of all executions</li>
<li><strong>Network Control</strong>: Host allowlisting for HTTP requests</li>
<li><strong>Non-Root Execution</strong>: All commands run as unprivileged users</li>
</ul>
<h3 id="design-principles"><a class="header" href="#design-principles">Design Principles</a></h3>
<ol>
<li><strong>Security by Default</strong>: Deny all, permit explicitly</li>
<li><strong>Defense in Depth</strong>: Multiple layers of security controls</li>
<li><strong>Least Privilege</strong>: Minimal capabilities granted for each operation</li>
<li><strong>Auditability</strong>: Complete logging and provenance metadata</li>
<li><strong>Fail-Safe</strong>: Errors default to blocking execution</li>
</ol>
<hr />
<h2 id="architecture"><a class="header" href="#architecture">Architecture</a></h2>
<pre><code class="language-mermaid">graph TB
    subgraph "Executor Arm"
        API[API Endpoint]
        VAL[Validator]
        EXEC[Executor]
        SAND[Sandbox Manager]
        PROV[Provenance Tracker]
    end

    subgraph "Security Layer"
        CAP[Capability Checker]
        ALLOW[Allowlist]
        HOST[Host Validator]
    end

    subgraph "Execution Environment"
        DOCKER[Docker Container]
        FS[Restricted Filesystem]
        NET[Network Namespace]
    end

    ORCH[Orchestrator] --&gt;|Execute Request + Token| API
    API --&gt; VAL
    VAL --&gt; CAP
    VAL --&gt; ALLOW
    VAL --&gt; HOST

    CAP --&gt;|Authorized| EXEC
    ALLOW --&gt;|Permitted| EXEC
    HOST --&gt;|Valid| EXEC

    EXEC --&gt; SAND
    SAND --&gt; DOCKER
    DOCKER --&gt; FS
    DOCKER --&gt; NET

    EXEC --&gt; PROV
    PROV --&gt;|Provenance Metadata| API
    API --&gt;|Execution Result| ORCH

    CAP --&gt;|Denied| API
    ALLOW --&gt;|Blocked| API
    HOST --&gt;|Invalid| API

    style DOCKER fill:#f9f,stroke:#333
    style CAP fill:#ff9,stroke:#333
    style PROV fill:#9ff,stroke:#333
</code></pre>
<h3 id="execution-flow"><a class="header" href="#execution-flow">Execution Flow</a></h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant O as Orchestrator
    participant E as Executor API
    participant V as Validator
    participant S as Sandbox
    participant D as Docker

    O-&gt;&gt;E: POST /execute (command + token)
    E-&gt;&gt;V: Validate request

    alt Token Valid
        V-&gt;&gt;V: Check capabilities
        alt Capability Granted
            V-&gt;&gt;V: Check allowlist
            alt Command Allowed
                V-&gt;&gt;S: Prepare sandbox
                S-&gt;&gt;D: Create container
                D--&gt;&gt;S: Container ready
                S-&gt;&gt;D: Execute command
                D--&gt;&gt;S: Output + exit code
                S-&gt;&gt;E: Execution result
                E-&gt;&gt;E: Generate provenance
                E--&gt;&gt;O: Success response
            else Command Blocked
                V--&gt;&gt;E: Allowlist violation
                E--&gt;&gt;O: Error: Command not allowed
            end
        else No Capability
            V--&gt;&gt;E: Capability violation
            E--&gt;&gt;O: Error: Insufficient privileges
        end
    else Token Invalid
        V--&gt;&gt;E: Auth failure
        E--&gt;&gt;O: Error: Invalid token
    end
</code></pre>
<hr />
<h2 id="security-model"><a class="header" href="#security-model">Security Model</a></h2>
<h3 id="capability-based-access-control"><a class="header" href="#capability-based-access-control">Capability-Based Access Control</a></h3>
<p>The Executor Arm uses a capability-based security model where each operation requires specific permissions granted through time-limited tokens.</p>
<pre><code class="language-rust">#[derive(Debug, Clone, Serialize, Deserialize)]
struct CapabilityToken {
    token_id: String,
    granted_capabilities: HashSet&lt;Capability&gt;,
    expires_at: DateTime&lt;Utc&gt;,
    issued_to: String,
}

#[derive(Debug, Clone, Hash, Eq, PartialEq, Serialize, Deserialize)]
enum Capability {
    // Shell command execution
    ShellRead,        // Read-only commands (ls, cat, grep)
    ShellWrite,       // Write commands (echo &gt;, mkdir)
    ShellExecute,     // Execute scripts

    // Network access
    HttpGet,          // HTTP GET requests
    HttpPost,         // HTTP POST requests
    HttpAllHosts,     // Access any host (vs allowlist)

    // File system
    FilesystemRead,   // Read files
    FilesystemWrite,  // Write files
    FilesystemDelete, // Delete files

    // Special
    PythonExec,       // Run Python scripts
    DockerAccess,     // Access Docker API
}

impl CapabilityToken {
    fn can_execute(&amp;self, required: &amp;Capability) -&gt; bool {
        !self.is_expired() &amp;&amp; self.granted_capabilities.contains(required)
    }

    fn is_expired(&amp;self) -&gt; bool {
        Utc::now() &gt; self.expires_at
    }
}</code></pre>
<h3 id="capability-types"><a class="header" href="#capability-types">Capability Types</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Capability</th><th>Description</th><th>Risk Level</th></tr></thead><tbody>
<tr><td><code>ShellRead</code></td><td>Read-only shell commands (ls, cat, grep)</td><td>Low</td></tr>
<tr><td><code>ShellWrite</code></td><td>Write operations (echo &gt;, mkdir)</td><td>Medium</td></tr>
<tr><td><code>ShellExecute</code></td><td>Execute scripts</td><td>High</td></tr>
<tr><td><code>HttpGet</code></td><td>HTTP GET requests to allowlisted hosts</td><td>Low</td></tr>
<tr><td><code>HttpPost</code></td><td>HTTP POST requests to allowlisted hosts</td><td>Medium</td></tr>
<tr><td><code>HttpAllHosts</code></td><td>HTTP requests to any host</td><td>High</td></tr>
<tr><td><code>FilesystemRead</code></td><td>Read files from sandbox</td><td>Low</td></tr>
<tr><td><code>FilesystemWrite</code></td><td>Write files to sandbox</td><td>Medium</td></tr>
<tr><td><code>FilesystemDelete</code></td><td>Delete files in sandbox</td><td>Medium</td></tr>
<tr><td><code>PythonExec</code></td><td>Execute Python scripts</td><td>High</td></tr>
<tr><td><code>DockerAccess</code></td><td>Access Docker API (privileged)</td><td>Critical</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="core-functionality"><a class="header" href="#core-functionality">Core Functionality</a></h2>
<h3 id="command-allowlist"><a class="header" href="#command-allowlist">Command Allowlist</a></h3>
<p>Only pre-approved commands can be executed, with required capabilities mapped to each command.</p>
<pre><code class="language-rust">struct Executor {
    allowed_commands: HashMap&lt;String, Vec&lt;Capability&gt;&gt;,
    allowed_hosts: Vec&lt;String&gt;,
    timeout: Duration,
}

impl Executor {
    fn default_safe() -&gt; Self {
        let mut allowed_commands = HashMap::new();

        // Read-only commands
        allowed_commands.insert("echo".to_string(), vec![Capability::ShellRead]);
        allowed_commands.insert("cat".to_string(), vec![Capability::ShellRead, Capability::FilesystemRead]);
        allowed_commands.insert("ls".to_string(), vec![Capability::ShellRead, Capability::FilesystemRead]);
        allowed_commands.insert("grep".to_string(), vec![Capability::ShellRead]);
        allowed_commands.insert("find".to_string(), vec![Capability::ShellRead, Capability::FilesystemRead]);
        allowed_commands.insert("head".to_string(), vec![Capability::ShellRead, Capability::FilesystemRead]);
        allowed_commands.insert("tail".to_string(), vec![Capability::ShellRead, Capability::FilesystemRead]);

        // Network commands
        allowed_commands.insert("curl".to_string(), vec![Capability::HttpGet]);
        allowed_commands.insert("wget".to_string(), vec![Capability::HttpGet]);

        // Version control (read-only)
        allowed_commands.insert("git".to_string(), vec![Capability::ShellRead, Capability::FilesystemRead]);

        Self {
            allowed_commands,
            allowed_hosts: vec![
                "api.github.com".to_string(),
                "registry.npmjs.org".to_string(),
                "pypi.org".to_string(),
            ],
            timeout: Duration::from_secs(30),
        }
    }
}</code></pre>
<h3 id="sandboxed-execution"><a class="header" href="#sandboxed-execution">Sandboxed Execution</a></h3>
<p>All commands execute in isolated environments with resource limits.</p>
<pre><code class="language-rust">impl Executor {
    async fn execute(&amp;self, req: ExecutionRequest, token: &amp;CapabilityToken) -&gt; Result&lt;ExecutionResult&gt; {
        // 1. Validate command is allowed
        self.validate_command(&amp;req.command, token)?;

        // 2. For HTTP requests, validate host
        if req.action_type == "http" {
            self.validate_host(&amp;req.command, token)?;
        }

        // 3. Execute with timeout and resource limits
        let result = self.execute_sandboxed(req).await?;

        // 4. Generate provenance metadata
        let provenance = self.generate_provenance(&amp;req, &amp;result);

        Ok(ExecutionResult {
            success: result.status.success(),
            stdout: String::from_utf8_lossy(&amp;result.stdout).to_string(),
            stderr: String::from_utf8_lossy(&amp;result.stderr).to_string(),
            exit_code: result.status.code(),
            duration_ms: result.duration.as_millis() as u64,
            provenance,
        })
    }

    async fn execute_sandboxed(&amp;self, req: ExecutionRequest) -&gt; Result&lt;CommandOutput&gt; {
        use tokio::process::Command;
        use tokio::time::timeout;

        let start = Instant::now();

        // Build command with resource limits
        let mut cmd = Command::new(&amp;req.command);
        cmd.args(&amp;req.args)
           .stdout(Stdio::piped())
           .stderr(Stdio::piped())
           .kill_on_drop(true);

        // Execute with timeout
        let output = timeout(self.timeout, cmd.output())
            .await
            .map_err(|_| Error::Timeout)?
            .map_err(|e| Error::Execution(e.to_string()))?;

        Ok(CommandOutput {
            status: output.status,
            stdout: output.stdout,
            stderr: output.stderr,
            duration: start.elapsed(),
        })
    }
}</code></pre>
<h3 id="resource-limits"><a class="header" href="#resource-limits">Resource Limits</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Resource</th><th>Limit</th><th>Rationale</th></tr></thead><tbody>
<tr><td><strong>Execution Timeout</strong></td><td>30 seconds (default)</td><td>Prevent infinite loops</td></tr>
<tr><td><strong>Memory</strong></td><td>512 MB</td><td>Limit resource consumption</td></tr>
<tr><td><strong>CPU</strong></td><td>1 core</td><td>Fair sharing</td></tr>
<tr><td><strong>Disk I/O</strong></td><td>Read-only root, writable /tmp</td><td>Prevent system modification</td></tr>
<tr><td><strong>Network</strong></td><td>Allowlisted hosts only</td><td>Prevent data exfiltration</td></tr>
<tr><td><strong>Process Count</strong></td><td>10 max</td><td>Prevent fork bombs</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="implementation"><a class="header" href="#implementation">Implementation</a></h2>
<h3 id="executor-structure"><a class="header" href="#executor-structure">Executor Structure</a></h3>
<pre><code class="language-rust">use actix_web::{web, App, HttpResponse, HttpServer};
use serde::{Deserialize, Serialize};
use std::collections::{HashMap, HashSet};
use std::time::{Duration, Instant};
use tokio::process::{Command, Stdio};
use chrono::{DateTime, Utc};

#[derive(Debug, Deserialize)]
struct ExecutionRequest {
    action_type: String,  // "shell", "http", "python"
    command: String,
    args: Vec&lt;String&gt;,
    timeout_seconds: Option&lt;u64&gt;,
    capability_token: String,
    metadata: HashMap&lt;String, String&gt;,
}

#[derive(Debug, Serialize)]
struct ExecutionResult {
    success: bool,
    stdout: String,
    stderr: String,
    exit_code: Option&lt;i32&gt;,
    duration_ms: u64,
    provenance: ProvenanceMetadata,
}

#[derive(Debug, Serialize)]
struct ProvenanceMetadata {
    arm_id: String,
    timestamp: DateTime&lt;Utc&gt;,
    action_type: String,
    command_hash: String,
    capabilities_used: Vec&lt;String&gt;,
}

struct CommandOutput {
    status: std::process::ExitStatus,
    stdout: Vec&lt;u8&gt;,
    stderr: Vec&lt;u8&gt;,
    duration: Duration,
}</code></pre>
<h3 id="command-validation"><a class="header" href="#command-validation">Command Validation</a></h3>
<pre><code class="language-rust">impl Executor {
    fn validate_command(&amp;self, command: &amp;str, token: &amp;CapabilityToken) -&gt; Result&lt;()&gt; {
        // Check if command is in allowlist
        let required_caps = self.allowed_commands
            .get(command)
            .ok_or(Error::CommandNotAllowed(command.to_string()))?;

        // Check if token has all required capabilities
        for cap in required_caps {
            if !token.can_execute(cap) {
                return Err(Error::InsufficientCapability {
                    required: cap.clone(),
                    command: command.to_string(),
                });
            }
        }

        Ok(())
    }

    fn validate_host(&amp;self, url: &amp;str, token: &amp;CapabilityToken) -&gt; Result&lt;()&gt; {
        // If token has HttpAllHosts, allow any host
        if token.can_execute(&amp;Capability::HttpAllHosts) {
            return Ok(());
        }

        // Otherwise, check allowlist
        let host = extract_host(url)?;
        if !self.allowed_hosts.contains(&amp;host) {
            return Err(Error::HostNotAllowed(host));
        }

        Ok(())
    }

    fn generate_provenance(&amp;self, req: &amp;ExecutionRequest, result: &amp;CommandOutput) -&gt; ProvenanceMetadata {
        use sha2::{Sha256, Digest};

        let command_str = format!("{} {}", req.command, req.args.join(" "));
        let mut hasher = Sha256::new();
        hasher.update(command_str.as_bytes());
        let command_hash = format!("{:x}", hasher.finalize());

        ProvenanceMetadata {
            arm_id: "executor".to_string(),
            timestamp: Utc::now(),
            action_type: req.action_type.clone(),
            command_hash,
            capabilities_used: self.get_used_capabilities(&amp;req.command),
        }
    }
}</code></pre>
<h3 id="execution-pipeline"><a class="header" href="#execution-pipeline">Execution Pipeline</a></h3>
<pre><code class="language-mermaid">graph LR
    A[Request] --&gt; B{Token Valid?}
    B --&gt;|No| Z[Error: Auth]
    B --&gt;|Yes| C{Capability?}
    C --&gt;|No| Z
    C --&gt;|Yes| D{Allowlist?}
    D --&gt;|No| Z
    D --&gt;|Yes| E{HTTP?}
    E --&gt;|Yes| F{Host OK?}
    F --&gt;|No| Z
    E --&gt;|No| G[Execute]
    F --&gt;|Yes| G
    G --&gt; H[Result]
    H --&gt; I[Provenance]
    I --&gt; J[Response]

    style Z fill:#f99,stroke:#333
    style J fill:#9f9,stroke:#333
</code></pre>
<hr />
<h2 id="api-specification"><a class="header" href="#api-specification">API Specification</a></h2>
<h3 id="execute-command"><a class="header" href="#execute-command">Execute Command</a></h3>
<p><strong>Endpoint</strong>: <code>POST /execute</code></p>
<p><strong>Headers</strong>:</p>
<pre><code>Content-Type: application/json
X-Request-ID: uuid (optional)
</code></pre>
<p><strong>Request Body</strong>:</p>
<pre><code class="language-json">{
  "action_type": "shell",
  "command": "ls",
  "args": ["-la", "/tmp"],
  "timeout_seconds": 10,
  "capability_token": "tok_abc123xyz",
  "metadata": {
    "task_id": "task-123",
    "requested_by": "orchestrator"
  }
}
</code></pre>
<p><strong>Field Descriptions</strong>:</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody>
<tr><td><code>action_type</code></td><td>string</td><td>Yes</td><td>Type of action: "shell", "http", "python"</td></tr>
<tr><td><code>command</code></td><td>string</td><td>Yes</td><td>Command to execute</td></tr>
<tr><td><code>args</code></td><td>array[string]</td><td>No</td><td>Command arguments</td></tr>
<tr><td><code>timeout_seconds</code></td><td>integer</td><td>No</td><td>Execution timeout (default: 30, max: 300)</td></tr>
<tr><td><code>capability_token</code></td><td>string</td><td>Yes</td><td>Authorization token with capabilities</td></tr>
<tr><td><code>metadata</code></td><td>object</td><td>No</td><td>Additional context for logging</td></tr>
</tbody></table>
</div>
<h3 id="response-formats"><a class="header" href="#response-formats">Response Formats</a></h3>
<p><strong>Success Response</strong> (200 OK):</p>
<pre><code class="language-json">{
  "success": true,
  "stdout": "total 32\ndrwxrwxrwt 10 root root 4096 Nov 10 10:30 .\ndrwxr-xr-x 20 root root 4096 Oct 15 08:12 ..",
  "stderr": "",
  "exit_code": 0,
  "duration_ms": 45,
  "provenance": {
    "arm_id": "executor",
    "timestamp": "2025-11-10T10:30:00Z",
    "action_type": "shell",
    "command_hash": "5d41402abc4b2a76b9719d911017c592",
    "capabilities_used": ["ShellRead", "FilesystemRead"]
  }
}
</code></pre>
<p><strong>Blocked Command</strong> (403 Forbidden):</p>
<pre><code class="language-json">{
  "success": false,
  "error": "Command 'rm' not in allowlist",
  "error_type": "CapabilityViolation",
  "allowed_commands": ["echo", "cat", "ls", "grep", "curl"]
}
</code></pre>
<p><strong>Invalid Token</strong> (401 Unauthorized):</p>
<pre><code class="language-json">{
  "success": false,
  "error": "Capability token expired or invalid",
  "error_type": "AuthenticationFailure"
}
</code></pre>
<p><strong>Execution Timeout</strong> (408 Request Timeout):</p>
<pre><code class="language-json">{
  "success": false,
  "error": "Command execution exceeded timeout of 30 seconds",
  "error_type": "ExecutionTimeout",
  "partial_output": "...",
  "duration_ms": 30000
}
</code></pre>
<hr />
<h2 id="data-models"><a class="header" href="#data-models">Data Models</a></h2>
<h3 id="capability-token"><a class="header" href="#capability-token">Capability Token</a></h3>
<pre><code class="language-rust">#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct CapabilityToken {
    pub token_id: String,
    pub granted_capabilities: HashSet&lt;Capability&gt;,
    pub expires_at: DateTime&lt;Utc&gt;,
    pub issued_to: String,
}</code></pre>
<h3 id="error-types"><a class="header" href="#error-types">Error Types</a></h3>
<pre><code class="language-rust">#[derive(Debug, thiserror::Error)]
pub enum Error {
    #[error("Command '{0}' not in allowlist")]
    CommandNotAllowed(String),

    #[error("Host '{0}' not in allowlist")]
    HostNotAllowed(String),

    #[error("Insufficient capability: {command} requires {required:?}")]
    InsufficientCapability {
        required: Capability,
        command: String,
    },

    #[error("Token expired or invalid")]
    InvalidToken,

    #[error("Execution timeout")]
    Timeout,

    #[error("Execution failed: {0}")]
    Execution(String),
}</code></pre>
<hr />
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<h3 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h3>
<pre><code class="language-bash"># Executor Configuration
EXECUTOR_PORT=8003
EXECUTOR_TIMEOUT_SECONDS=30
EXECUTOR_MAX_CONCURRENT=10

# Security
EXECUTOR_ALLOWLIST_PATH=/etc/executor/allowlist.yaml
EXECUTOR_HOST_ALLOWLIST_PATH=/etc/executor/hosts.yaml
CAPABILITY_TOKEN_VERIFIER_URL=http://orchestrator:8000/verify-token

# Sandbox
SANDBOX_TYPE=docker  # docker, kubernetes, firecracker
SANDBOX_IMAGE=executor-sandbox:latest
SANDBOX_MEMORY_LIMIT=512m
SANDBOX_CPU_LIMIT=1.0

# Logging
LOG_LEVEL=info
LOG_FORMAT=json
PROVENANCE_LOG_PATH=/var/log/executor/provenance.jsonl
</code></pre>
<h3 id="allowlist-configuration"><a class="header" href="#allowlist-configuration">Allowlist Configuration</a></h3>
<p><strong>allowlist.yaml</strong>:</p>
<pre><code class="language-yaml">commands:
  # Read-only commands
  - name: echo
    capabilities:
      - ShellRead
    description: "Print text"

  - name: cat
    capabilities:
      - ShellRead
      - FilesystemRead
    description: "Display file contents"

  - name: ls
    capabilities:
      - ShellRead
      - FilesystemRead
    description: "List directory contents"

  # Network commands
  - name: curl
    capabilities:
      - HttpGet
    description: "HTTP GET requests"

  - name: wget
    capabilities:
      - HttpGet
    description: "Download files"

# Host allowlist
hosts:
  - api.github.com
  - registry.npmjs.org
  - pypi.org
  - api.openai.com

# Sandbox configuration
sandbox:
  memory_limit: "512m"
  cpu_limit: 1.0
  timeout_seconds: 30
  max_processes: 10
  readonly_root: true
  writable_paths:
    - /tmp
    - /workspace
</code></pre>
<hr />
<h2 id="performance-characteristics"><a class="header" href="#performance-characteristics">Performance Characteristics</a></h2>
<h3 id="latency"><a class="header" href="#latency">Latency</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Operation</th><th>P50</th><th>P95</th><th>P99</th></tr></thead><tbody>
<tr><td>Command validation</td><td>5ms</td><td>10ms</td><td>15ms</td></tr>
<tr><td>Sandbox creation</td><td>200ms</td><td>500ms</td><td>1s</td></tr>
<tr><td>Command execution</td><td>50ms</td><td>2s</td><td>5s</td></tr>
<tr><td>Total latency</td><td>255ms</td><td>2.5s</td><td>6s</td></tr>
</tbody></table>
</div>
<h3 id="throughput"><a class="header" href="#throughput">Throughput</a></h3>
<ul>
<li><strong>Concurrent Executions</strong>: 10 (configurable)</li>
<li><strong>Queue Depth</strong>: 100 requests</li>
<li><strong>Requests/Second</strong>: ~40 (with 10 workers)</li>
</ul>
<h3 id="resource-usage"><a class="header" href="#resource-usage">Resource Usage</a></h3>
<ul>
<li><strong>Memory</strong>: 50 MB base + 512 MB per sandbox</li>
<li><strong>CPU</strong>: Minimal (execution in sandbox)</li>
<li><strong>Disk</strong>: 10 MB logs per hour</li>
</ul>
<hr />
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<h3 id="unit-tests"><a class="header" href="#unit-tests">Unit Tests</a></h3>
<pre><code class="language-rust">#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_capability_validation() {
        let mut caps = HashSet::new();
        caps.insert(Capability::ShellRead);

        let token = CapabilityToken {
            token_id: "test".to_string(),
            granted_capabilities: caps,
            expires_at: Utc::now() + Duration::from_secs(3600),
            issued_to: "test".to_string(),
        };

        assert!(token.can_execute(&amp;Capability::ShellRead));
        assert!(!token.can_execute(&amp;Capability::ShellWrite));
    }

    #[test]
    fn test_token_expiration() {
        let token = CapabilityToken {
            token_id: "test".to_string(),
            granted_capabilities: HashSet::new(),
            expires_at: Utc::now() - Duration::from_secs(1),
            issued_to: "test".to_string(),
        };

        assert!(token.is_expired());
    }

    #[tokio::test]
    async fn test_command_allowlist() {
        let executor = Executor::default_safe();

        let mut caps = HashSet::new();
        caps.insert(Capability::ShellRead);
        caps.insert(Capability::FilesystemRead);

        let token = CapabilityToken {
            token_id: "test".to_string(),
            granted_capabilities: caps,
            expires_at: Utc::now() + Duration::from_secs(3600),
            issued_to: "test".to_string(),
        };

        // Should succeed
        assert!(executor.validate_command("ls", &amp;token).is_ok());

        // Should fail (not in allowlist)
        assert!(executor.validate_command("rm", &amp;token).is_err());
    }
}</code></pre>
<h3 id="integration-tests"><a class="header" href="#integration-tests">Integration Tests</a></h3>
<pre><code class="language-rust">#[tokio::test]
async fn test_execute_safe_command() {
    let executor = Executor::default_safe();

    let mut caps = HashSet::new();
    caps.insert(Capability::ShellRead);

    let token = CapabilityToken {
        token_id: "test".to_string(),
        granted_capabilities: caps,
        expires_at: Utc::now() + Duration::from_secs(3600),
        issued_to: "test".to_string(),
    };

    let req = ExecutionRequest {
        action_type: "shell".to_string(),
        command: "echo".to_string(),
        args: vec!["Hello, World!".to_string()],
        timeout_seconds: Some(5),
        capability_token: token.token_id.clone(),
        metadata: HashMap::new(),
    };

    let result = executor.execute(req, &amp;token).await.unwrap();

    assert!(result.success);
    assert_eq!(result.stdout.trim(), "Hello, World!");
    assert_eq!(result.exit_code, Some(0));
}

#[tokio::test]
async fn test_blocked_command() {
    let executor = Executor::default_safe();

    let mut caps = HashSet::new();
    caps.insert(Capability::ShellRead);

    let token = CapabilityToken {
        token_id: "test".to_string(),
        granted_capabilities: caps,
        expires_at: Utc::now() + Duration::from_secs(3600),
        issued_to: "test".to_string(),
    };

    let req = ExecutionRequest {
        action_type: "shell".to_string(),
        command: "rm".to_string(),  // Not in allowlist
        args: vec!["-rf".to_string(), "/".to_string()],
        timeout_seconds: Some(5),
        capability_token: token.token_id.clone(),
        metadata: HashMap::new(),
    };

    let result = executor.execute(req, &amp;token).await;
    assert!(result.is_err());
}</code></pre>
<hr />
<h2 id="deployment"><a class="header" href="#deployment">Deployment</a></h2>
<h3 id="docker-sandbox"><a class="header" href="#docker-sandbox">Docker Sandbox</a></h3>
<p><strong>Dockerfile</strong>:</p>
<pre><code class="language-dockerfile">FROM debian:bookworm-slim

# Install minimal toolset
RUN apt-get update &amp;&amp; apt-get install -y \
    curl \
    git \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

# Create non-root user
RUN useradd -m -s /bin/bash executor
USER executor

# Set restrictive umask
RUN echo "umask 077" &gt;&gt; /home/executor/.bashrc

WORKDIR /workspace

# No CMD - controlled by executor service
</code></pre>
<h3 id="kubernetes-configuration"><a class="header" href="#kubernetes-configuration">Kubernetes Configuration</a></h3>
<p><strong>deployment.yaml</strong>:</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: executor-arm
  namespace: octollm
spec:
  replicas: 2
  selector:
    matchLabels:
      app: executor-arm
  template:
    metadata:
      labels:
        app: executor-arm
    spec:
      serviceAccountName: executor-arm

      # Security Context
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        fsGroup: 1000
        seccompProfile:
          type: RuntimeDefault

      containers:
      - name: executor
        image: octollm/executor-arm:1.0

        # Container Security
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop:
              - ALL

        # Resource Limits
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "1Gi"
            cpu: "1000m"

        # Port
        ports:
        - containerPort: 8003
          name: http

        # Configuration
        env:
        - name: EXECUTOR_PORT
          value: "8003"
        - name: EXECUTOR_TIMEOUT_SECONDS
          value: "30"
        - name: SANDBOX_TYPE
          value: "docker"

        # Config Volume
        volumeMounts:
        - name: config
          mountPath: /etc/executor
          readOnly: true
        - name: tmp
          mountPath: /tmp

      volumes:
      - name: config
        configMap:
          name: executor-config
      - name: tmp
        emptyDir: {}

---
apiVersion: v1
kind: Service
metadata:
  name: executor-arm
  namespace: octollm
spec:
  selector:
    app: executor-arm
  ports:
  - port: 8003
    targetPort: 8003
    name: http
  type: ClusterIP
</code></pre>
<p><strong>ConfigMap</strong>:</p>
<pre><code class="language-yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: executor-config
  namespace: octollm
data:
  allowlist.yaml: |
    commands:
      - name: echo
        capabilities: [ShellRead]
      - name: cat
        capabilities: [ShellRead, FilesystemRead]
      - name: ls
        capabilities: [ShellRead, FilesystemRead]
      - name: curl
        capabilities: [HttpGet]

    hosts:
      - api.github.com
      - pypi.org

    sandbox:
      memory_limit: "512m"
      timeout_seconds: 30
</code></pre>
<hr />
<h2 id="security-considerations"><a class="header" href="#security-considerations">Security Considerations</a></h2>
<h3 id="threat-model"><a class="header" href="#threat-model">Threat Model</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Threat</th><th>Mitigation</th></tr></thead><tbody>
<tr><td><strong>Command Injection</strong></td><td>Strict allowlist, no shell interpolation</td></tr>
<tr><td><strong>Privilege Escalation</strong></td><td>Non-root execution, capability restrictions</td></tr>
<tr><td><strong>Resource Exhaustion</strong></td><td>Timeouts, memory limits, process limits</td></tr>
<tr><td><strong>Data Exfiltration</strong></td><td>Host allowlist, network namespace isolation</td></tr>
<tr><td><strong>Sandbox Escape</strong></td><td>Defense in depth: seccomp, AppArmor, read-only root</td></tr>
<tr><td><strong>Token Theft</strong></td><td>Short-lived tokens, secure storage, HTTPS only</td></tr>
</tbody></table>
</div>
<h3 id="security-best-practices"><a class="header" href="#security-best-practices">Security Best Practices</a></h3>
<ol>
<li><strong>Never Run as Root</strong>: All executions use unprivileged users</li>
<li><strong>Minimal Capabilities</strong>: Grant only required capabilities</li>
<li><strong>Short-Lived Tokens</strong>: Tokens expire after 1 hour by default</li>
<li><strong>Audit Logging</strong>: Log all executions with provenance metadata</li>
<li><strong>Network Isolation</strong>: Use network policies in Kubernetes</li>
<li><strong>Regular Updates</strong>: Keep sandbox images and tools updated</li>
<li><strong>Penetration Testing</strong>: Regular security assessments</li>
</ol>
<hr />
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="../orchestrator.html">Orchestrator Component</a> - Token issuance and coordination</li>
<li><a href="./planner-arm.html">Planner Arm</a> - Task decomposition that generates execution plans</li>
<li><a href="./guardian-arm.html">Safety Guardian Arm</a> - Pre-execution validation</li>
<li><a href="../../security/overview.html">Security Architecture</a> - System-wide security model</li>
<li><a href="../../security/capability-isolation.html">Capability Isolation</a> - Detailed capability design</li>
<li><a href="../../api/rest-api.html">API Reference</a> - Complete API documentation</li>
</ul>
<hr />
<p><strong>Document Status</strong>: Phase 1 Complete
<strong>Last Updated</strong>: 2025-11-10
<strong>Maintainer</strong>: OctoLLM Core Team
<strong>Next Review</strong>: 2025-12-10</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../components/arms/planner-arm.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../components/arms/retriever-arm.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../components/arms/planner-arm.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../components/arms/retriever-arm.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
