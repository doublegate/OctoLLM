<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Coder Arm - OctoLLM Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Distributed AI Architecture for Offensive Security and Developer Tooling - Comprehensive technical documentation covering architecture, API, development, operations, and security.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OctoLLM Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/doublegate/OctoLLM" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/doublegate/OctoLLM/edit/main/docs/src/components/arms/coder-arm.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="coder-arm-code-generation--analysis"><a class="header" href="#coder-arm-code-generation--analysis">Coder Arm: Code Generation &amp; Analysis</a></h1>
<p><strong>Components</strong> &gt; <strong>Arms</strong> &gt; Coder Arm</p>
<p><strong>Version</strong>: 1.0
<strong>Technology</strong>: Python 3.11+ / FastAPI
<strong>Cost Tier</strong>: 4 (High)
<strong>Average Latency</strong>: 2-5 seconds
<strong>Status</strong>: Phase 1 Complete</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#core-functionality">Core Functionality</a>
<ul>
<li><a href="#code-request-types">Code Request Types</a></li>
<li><a href="#code-generation">Code Generation</a></li>
<li><a href="#syntax-validation">Syntax Validation</a></li>
<li><a href="#context-aware-prompts">Context-Aware Prompts</a></li>
</ul>
</li>
<li><a href="#memory-system">Memory System</a>
<ul>
<li><a href="#local-episodic-memory">Local Episodic Memory</a></li>
<li><a href="#solution-storage">Solution Storage</a></li>
<li><a href="#similarity-search">Similarity Search</a></li>
</ul>
</li>
<li><a href="#implementation">Implementation</a>
<ul>
<li><a href="#coderarm-class">CoderArm Class</a></li>
<li><a href="#request-processing">Request Processing</a></li>
<li><a href="#llm-integration">LLM Integration</a></li>
</ul>
</li>
<li><a href="#api-specification">API Specification</a>
<ul>
<li><a href="#generate-code">Generate Code</a></li>
<li><a href="#debug-code">Debug Code</a></li>
<li><a href="#refactor-code">Refactor Code</a></li>
</ul>
</li>
<li><a href="#data-models">Data Models</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#performance-characteristics">Performance Characteristics</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#deployment">Deployment</a></li>
<li><a href="#supported-languages">Supported Languages</a></li>
<li><a href="#see-also">See Also</a></li>
</ul>
<hr />
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The Coder Arm is a specialized component that excels at code generation, debugging, refactoring, and static analysis across multiple programming languages. It leverages large language models (GPT-4) and maintains a local episodic memory of past solutions to improve future responses.</p>
<h3 id="key-features"><a class="header" href="#key-features">Key Features</a></h3>
<ul>
<li><strong>Multi-Language Support</strong>: Python, JavaScript, Go, Rust, Java, and more</li>
<li><strong>Multiple Operations</strong>: Generate, debug, refactor, analyze, test, explain, optimize</li>
<li><strong>Context-Aware</strong>: Uses past solutions and project context</li>
<li><strong>Syntax Validation</strong>: Automatic validation and error correction</li>
<li><strong>Episodic Memory</strong>: Stores and retrieves similar solutions</li>
<li><strong>High Confidence</strong>: Returns confidence scores and warnings</li>
<li><strong>Production-Ready</strong>: Follows language-specific best practices</li>
</ul>
<h3 id="design-principles"><a class="header" href="#design-principles">Design Principles</a></h3>
<ol>
<li><strong>Quality Over Speed</strong>: Prioritize correct, idiomatic code</li>
<li><strong>Learn from Past</strong>: Use memory to improve over time</li>
<li><strong>Validate Always</strong>: Check syntax before returning</li>
<li><strong>Explain Clearly</strong>: Provide explanations and rationale</li>
<li><strong>Handle Uncertainty</strong>: Return confidence scores and warnings</li>
</ol>
<hr />
<h2 id="architecture"><a class="header" href="#architecture">Architecture</a></h2>
<pre><code class="language-mermaid">graph TB
    subgraph "Coder Arm"
        API[API Endpoint]
        PROC[Request Processor]
        MEM[Memory Search]
        PROMPT[Prompt Builder]
        LLM[LLM Interface]
        VAL[Syntax Validator]
        STORE[Memory Storage]
    end

    subgraph "External Services"
        GPT[GPT-4 API]
        QDRANT[Qdrant Vector DB]
    end

    subgraph "Validation Tools"
        PY[Python AST]
        JS[ESLint]
        GO[gofmt]
        RUST[rustc]
    end

    ORCH[Orchestrator] --&gt;|Code Request| API
    API --&gt; PROC
    PROC --&gt; MEM
    MEM --&gt; QDRANT
    QDRANT --&gt;|Similar Solutions| MEM

    MEM --&gt; PROMPT
    PROC --&gt; PROMPT
    PROMPT --&gt; LLM
    LLM --&gt; GPT
    GPT --&gt;|Generated Code| LLM

    LLM --&gt; VAL
    VAL --&gt; PY
    VAL --&gt; JS
    VAL --&gt; GO
    VAL --&gt; RUST

    VAL --&gt;|Valid| STORE
    VAL --&gt;|Invalid| LLM
    STORE --&gt; QDRANT

    STORE --&gt;|Code Response| API
    API --&gt;|Result| ORCH

    style GPT fill:#f9f,stroke:#333
    style QDRANT fill:#9ff,stroke:#333
    style VAL fill:#ff9,stroke:#333
</code></pre>
<h3 id="code-generation-flow"><a class="header" href="#code-generation-flow">Code Generation Flow</a></h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant O as Orchestrator
    participant C as Coder Arm
    participant M as Memory
    participant L as LLM (GPT-4)
    participant V as Validator

    O-&gt;&gt;C: Code Request

    C-&gt;&gt;M: Search similar solutions
    M--&gt;&gt;C: Past solutions (0-3)

    C-&gt;&gt;C: Build context prompt
    C-&gt;&gt;L: Generate code

    L--&gt;&gt;C: Generated code

    C-&gt;&gt;V: Validate syntax

    alt Syntax Valid
        V--&gt;&gt;C: Valid
        C-&gt;&gt;M: Store solution
        C--&gt;&gt;O: Code Response (success)
    else Syntax Invalid
        V--&gt;&gt;C: Errors
        C-&gt;&gt;L: Fix syntax errors
        L--&gt;&gt;C: Fixed code
        C-&gt;&gt;V: Re-validate
        alt Fixed
            V--&gt;&gt;C: Valid
            C-&gt;&gt;M: Store solution
            C--&gt;&gt;O: Code Response (success)
        else Still Invalid
            V--&gt;&gt;C: Still invalid
            C--&gt;&gt;O: Code Response (error)
        end
    end
</code></pre>
<hr />
<h2 id="core-functionality"><a class="header" href="#core-functionality">Core Functionality</a></h2>
<h3 id="code-request-types"><a class="header" href="#code-request-types">Code Request Types</a></h3>
<pre><code class="language-python">from enum import Enum

class CodeRequestType(str, Enum):
    GENERATE = "generate"      # Create new code from scratch
    DEBUG = "debug"            # Find and fix bugs
    REFACTOR = "refactor"      # Improve code structure
    ANALYZE = "analyze"        # Static analysis
    TEST = "test"              # Generate unit tests
    EXPLAIN = "explain"        # Explain code behavior
    OPTIMIZE = "optimize"      # Performance optimization
</code></pre>
<h3 id="code-generation"><a class="header" href="#code-generation">Code Generation</a></h3>
<p>The Coder Arm generates code through a multi-step process:</p>
<ol>
<li><strong>Memory Search</strong>: Find similar past solutions</li>
<li><strong>Prompt Building</strong>: Create context-aware prompt with constraints</li>
<li><strong>LLM Generation</strong>: Generate code using GPT-4</li>
<li><strong>Syntax Validation</strong>: Check for syntax errors</li>
<li><strong>Error Correction</strong>: Attempt to fix invalid syntax</li>
<li><strong>Memory Storage</strong>: Store successful solution</li>
</ol>
<pre><code class="language-python">class CoderArm:
    """Code generation and analysis specialist."""

    def __init__(self, llm_model: str = "gpt-4"):
        self.model = llm_model
        self.memory = CoderMemory()  # Local episodic memory
        self.validators = CodeValidators()

    async def process_request(self, req: CodeRequest) -&gt; CodeResponse:
        """Process code request based on type."""

        # Check memory for similar past solutions
        similar = await self.memory.search_similar(
            req.instruction,
            language=req.language,
            limit=3
        )

        # Build context-aware prompt
        prompt = self._build_prompt(req, similar)

        # Generate code using LLM
        code_result = await self._generate_code(prompt, req)

        # Validate syntax
        validation = await self.validators.validate_syntax(
            code_result["code"],
            req.language
        )

        if not validation.valid:
            # Attempt to fix syntax errors
            code_result = await self._fix_syntax(code_result, validation)

        # Store in memory for future reference
        await self.memory.store_solution(
            instruction=req.instruction,
            code=code_result["code"],
            language=req.language,
            metadata=code_result.get("metadata", {})
        )

        return CodeResponse(**code_result)
</code></pre>
<h3 id="syntax-validation"><a class="header" href="#syntax-validation">Syntax Validation</a></h3>
<p>Language-specific validators check generated code:</p>
<pre><code class="language-python">class CodeValidators:
    """Syntax validators for multiple languages."""

    async def validate_syntax(self, code: str, language: str) -&gt; ValidationResult:
        """Validate syntax for given language."""

        validators = {
            "python": self._validate_python,
            "javascript": self._validate_javascript,
            "typescript": self._validate_typescript,
            "go": self._validate_go,
            "rust": self._validate_rust,
            "java": self._validate_java,
        }

        validator = validators.get(language.lower())
        if not validator:
            return ValidationResult(valid=True, message="No validator for language")

        return await validator(code)

    async def _validate_python(self, code: str) -&gt; ValidationResult:
        """Validate Python code using AST."""
        import ast
        try:
            ast.parse(code)
            return ValidationResult(valid=True, message="Valid Python")
        except SyntaxError as e:
            return ValidationResult(
                valid=False,
                message=f"Syntax error: {e}",
                line=e.lineno,
                column=e.offset
            )
</code></pre>
<h3 id="context-aware-prompts"><a class="header" href="#context-aware-prompts">Context-Aware Prompts</a></h3>
<p>Prompts include constraints, existing code, and similar solutions:</p>
<pre><code class="language-python">def _build_prompt(self, req: CodeRequest, similar_solutions: List[Dict]) -&gt; str:
    """Build context-aware prompt."""

    base_prompt = f"""You are an expert {req.language} programmer.

Task: {req.request_type.value}
Instruction: {req.instruction}

Language: {req.language}
Constraints:
{chr(10).join(f"- {c}" for c in req.constraints) if req.constraints else "None"}"""

    if req.existing_code:
        base_prompt += f"\n\nExisting code:\n```{req.language}\n{req.existing_code}\n```"

    if similar_solutions:
        base_prompt += "\n\nSimilar past solutions for reference:"
        for idx, sol in enumerate(similar_solutions, 1):
            base_prompt += f"\n{idx}. {sol['description']}\n```{sol['language']}\n{sol['code'][:200]}...\n```"

    base_prompt += """

Requirements:
1. Write clean, idiomatic code following best practices
2. Include helpful comments for complex logic
3. Handle edge cases and errors appropriately
4. Follow the language's style guide (PEP 8, Go fmt, etc.)
5. Ensure code is production-ready

Output format:
```json
{
  "code": "// Full code here",
  "explanation": "Brief explanation of approach and key decisions",
  "confidence": 0.85,
  "warnings": ["Any caveats or limitations"],
  "tests": "// Optional test code if requested"
}
```"""

    return base_prompt
</code></pre>
<hr />
<h2 id="memory-system"><a class="header" href="#memory-system">Memory System</a></h2>
<h3 id="local-episodic-memory"><a class="header" href="#local-episodic-memory">Local Episodic Memory</a></h3>
<p>The Coder Arm maintains a local vector database of past code solutions using Qdrant.</p>
<pre><code class="language-python">from qdrant_client import QdrantClient
from qdrant_client.models import Distance, VectorParams, PointStruct
from sentence_transformers import SentenceTransformer

class CoderMemory:
    """Local episodic memory for code solutions."""

    def __init__(self, qdrant_url: str = "http://qdrant:6333"):
        self.client = QdrantClient(url=qdrant_url)
        self.collection = "coder_memory"
        self.encoder = SentenceTransformer('all-MiniLM-L6-v2')
        self._init_collection()

    def _init_collection(self):
        """Initialize Qdrant collection."""
        try:
            self.client.create_collection(
                collection_name=self.collection,
                vectors_config=VectorParams(
                    size=384,  # all-MiniLM-L6-v2 dimension
                    distance=Distance.COSINE
                )
            )
        except Exception:
            pass  # Collection already exists
</code></pre>
<h3 id="solution-storage"><a class="header" href="#solution-storage">Solution Storage</a></h3>
<p>Solutions are stored with embeddings for semantic search:</p>
<pre><code class="language-python">async def store_solution(
    self,
    instruction: str,
    code: str,
    language: str,
    metadata: Dict[str, Any]
) -&gt; str:
    """Store code solution in memory."""

    # Create embedding from instruction + code snippet
    text_for_embedding = f"{instruction}\n{code[:500]}"
    embedding = self.encoder.encode(text_for_embedding).tolist()

    point_id = str(uuid.uuid4())

    self.client.upsert(
        collection_name=self.collection,
        points=[
            PointStruct(
                id=point_id,
                vector=embedding,
                payload={
                    "instruction": instruction,
                    "code": code,
                    "language": language,
                    "created_at": datetime.utcnow().isoformat(),
                    **metadata
                }
            )
        ]
    )

    return point_id
</code></pre>
<h3 id="similarity-search"><a class="header" href="#similarity-search">Similarity Search</a></h3>
<p>Find similar solutions using vector similarity:</p>
<pre><code class="language-python">async def search_similar(
    self,
    query: str,
    language: Optional[str] = None,
    limit: int = 5
) -&gt; List[Dict[str, Any]]:
    """Search for similar code solutions."""

    query_vector = self.encoder.encode(query).tolist()

    # Build filter
    search_filter = None
    if language:
        from qdrant_client.models import Filter, FieldCondition, MatchValue
        search_filter = Filter(
            must=[
                FieldCondition(
                    key="language",
                    match=MatchValue(value=language)
                )
            ]
        )

    results = self.client.search(
        collection_name=self.collection,
        query_vector=query_vector,
        query_filter=search_filter,
        limit=limit
    )

    return [
        {
            "description": r.payload["instruction"],
            "code": r.payload["code"],
            "language": r.payload["language"],
            "score": r.score,
            "created_at": r.payload["created_at"]
        }
        for r in results
    ]
</code></pre>
<hr />
<h2 id="implementation"><a class="header" href="#implementation">Implementation</a></h2>
<h3 id="coderarm-class"><a class="header" href="#coderarm-class">CoderArm Class</a></h3>
<p>Full implementation with LLM integration:</p>
<pre><code class="language-python">from typing import List, Dict, Any, Optional
from pydantic import BaseModel, Field
import openai
import json
import uuid
from datetime import datetime

class CoderArm:
    """Code generation and analysis specialist."""

    def __init__(self, llm_model: str = "gpt-4"):
        self.model = llm_model
        self.memory = CoderMemory()
        self.validators = CodeValidators()

    async def _generate_code(self, prompt: str, req: CodeRequest) -&gt; Dict[str, Any]:
        """Generate code using LLM."""

        response = await openai.ChatCompletion.acreate(
            model=self.model,
            messages=[
                {"role": "system", "content": f"You are an expert {req.language} programmer."},
                {"role": "user", "content": prompt}
            ],
            temperature=0.2 if req.request_type == "generate" else 0.1,
            max_tokens=4000
        )

        content = response.choices[0].message.content

        # Extract JSON from response
        if "```json" in content:
            json_str = content.split("```json")[1].split("```")[0]
        else:
            json_str = content

        result = json.loads(json_str)
        result["language"] = req.language
        result["success"] = True

        return result

    async def _fix_syntax(self, code_result: Dict, validation: ValidationResult) -&gt; Dict:
        """Attempt to fix syntax errors."""

        fix_prompt = f"""The following code has syntax errors:

```{code_result['language']}
{code_result['code']}
</code></pre>
<p>Error: {validation.message}
Line {validation.line}, Column {validation.column}</p>
<p>Please fix the syntax error and return the corrected code in the same JSON format."""</p>
<pre><code>    response = await openai.ChatCompletion.acreate(
        model=self.model,
        messages=[
            {"role": "system", "content": f"You are an expert {code_result['language']} programmer."},
            {"role": "user", "content": fix_prompt}
        ],
        temperature=0.1,
        max_tokens=4000
    )

    content = response.choices[0].message.content

    if "```json" in content:
        json_str = content.split("```json")[1].split("```")[0]
    else:
        json_str = content

    fixed_result = json.loads(json_str)
    fixed_result["language"] = code_result["language"]
    fixed_result["success"] = True

    return fixed_result
</code></pre>
<pre><code>
### Request Processing

FastAPI endpoint implementation:

```python
from fastapi import FastAPI, HTTPException

app = FastAPI(title="Coder Arm")
coder = CoderArm()

@app.post("/code", response_model=CodeResponse)
async def generate_code(request: CodeRequest) -&gt; CodeResponse:
    """Generate, debug, or refactor code."""

    try:
        response = await coder.process_request(request)
        return response
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/health")
async def health_check():
    """Health check endpoint."""
    return {"status": "healthy", "model": coder.model}

@app.get("/memory/stats")
async def memory_stats():
    """Get memory statistics."""
    collection_info = coder.memory.client.get_collection(coder.memory.collection)
    return {
        "total_solutions": collection_info.points_count,
        "vector_dimension": collection_info.config.params.vectors.size
    }
</code></pre>
<h3 id="llm-integration"><a class="header" href="#llm-integration">LLM Integration</a></h3>
<p>OpenAI API integration with error handling:</p>
<pre><code class="language-python">async def call_llm_with_retry(
    messages: List[Dict],
    model: str,
    max_retries: int = 3
) -&gt; str:
    """Call LLM with exponential backoff retry."""

    for attempt in range(max_retries):
        try:
            response = await openai.ChatCompletion.acreate(
                model=model,
                messages=messages,
                temperature=0.2,
                max_tokens=4000,
                timeout=30
            )
            return response.choices[0].message.content

        except openai.error.RateLimitError:
            wait_time = 2 ** attempt
            await asyncio.sleep(wait_time)

        except openai.error.APIError as e:
            if attempt == max_retries - 1:
                raise
            await asyncio.sleep(1)

    raise Exception("Max retries exceeded")
</code></pre>
<hr />
<h2 id="api-specification"><a class="header" href="#api-specification">API Specification</a></h2>
<h3 id="generate-code"><a class="header" href="#generate-code">Generate Code</a></h3>
<p><strong>Endpoint</strong>: <code>POST /code</code></p>
<p><strong>Request Body</strong>:</p>
<pre><code class="language-json">{
  "request_type": "generate",
  "language": "python",
  "instruction": "Create a function that validates email addresses using regex",
  "context": {
    "project_type": "web_api",
    "framework": "fastapi"
  },
  "constraints": [
    "Must support RFC 5322 standard",
    "Include docstring with examples",
    "Add type hints"
  ]
}
</code></pre>
<p><strong>Response</strong> (200 OK):</p>
<pre><code class="language-json">{
  "success": true,
  "code": "import re\nfrom typing import Optional\n\ndef validate_email(email: str) -&gt; bool:\n    \"\"\"Validate email address using RFC 5322 regex.\n    \n    Args:\n        email: Email address to validate\n    \n    Returns:\n        True if valid, False otherwise\n    \n    Examples:\n        &gt;&gt;&gt; validate_email('user@example.com')\n        True\n        &gt;&gt;&gt; validate_email('invalid.email')\n        False\n    \"\"\"\n    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$'\n    return bool(re.match(pattern, email))",
  "explanation": "Created a simple email validator using regex. The pattern matches standard email formats per RFC 5322. Includes type hints and comprehensive docstring with examples.",
  "language": "python",
  "tests": "import pytest\n\ndef test_validate_email_valid():\n    assert validate_email('user@example.com') == True\n\ndef test_validate_email_invalid():\n    assert validate_email('invalid') == False",
  "confidence": 0.92,
  "warnings": [
    "Regex validation is not 100% RFC 5322 compliant - consider using email-validator library for production"
  ],
  "metadata": {
    "model": "gpt-4",
    "tokens_used": 450,
    "memory_hits": 2
  }
}
</code></pre>
<h3 id="debug-code"><a class="header" href="#debug-code">Debug Code</a></h3>
<p><strong>Request Body</strong>:</p>
<pre><code class="language-json">{
  "request_type": "debug",
  "language": "python",
  "instruction": "Fix the bug causing IndexError",
  "existing_code": "def get_item(items, index):\n    return items[index]\n\nresult = get_item([1, 2, 3], 5)",
  "constraints": [
    "Add proper error handling",
    "Return None for invalid indices"
  ]
}
</code></pre>
<p><strong>Response</strong>:</p>
<pre><code class="language-json">{
  "success": true,
  "code": "def get_item(items, index):\n    \"\"\"Get item at index, returning None if invalid.\"\"\"\n    try:\n        return items[index]\n    except IndexError:\n        return None\n\nresult = get_item([1, 2, 3], 5)  # Returns None",
  "explanation": "Added try-except block to handle IndexError. Function now returns None for invalid indices instead of raising exception.",
  "language": "python",
  "confidence": 0.95,
  "warnings": [],
  "metadata": {
    "bug_type": "IndexError",
    "fix_applied": "exception_handling"
  }
}
</code></pre>
<h3 id="refactor-code"><a class="header" href="#refactor-code">Refactor Code</a></h3>
<p><strong>Request Body</strong>:</p>
<pre><code class="language-json">{
  "request_type": "refactor",
  "language": "javascript",
  "instruction": "Refactor to use async/await instead of callbacks",
  "existing_code": "function fetchData(url, callback) {\n  fetch(url)\n    .then(res =&gt; res.json())\n    .then(data =&gt; callback(null, data))\n    .catch(err =&gt; callback(err, null));\n}"
}
</code></pre>
<p><strong>Response</strong>:</p>
<pre><code class="language-json">{
  "success": true,
  "code": "async function fetchData(url) {\n  try {\n    const response = await fetch(url);\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    throw error;\n  }\n}",
  "explanation": "Converted callback-based function to async/await for cleaner error handling and better readability. Removed callback parameter and use direct return/throw.",
  "language": "javascript",
  "confidence": 0.94,
  "warnings": [
    "Callers must now use try-catch or .catch() when calling this function"
  ],
  "metadata": {
    "refactor_type": "callback_to_async"
  }
}
</code></pre>
<hr />
<h2 id="data-models"><a class="header" href="#data-models">Data Models</a></h2>
<h3 id="request-model"><a class="header" href="#request-model">Request Model</a></h3>
<pre><code class="language-python">class CodeRequest(BaseModel):
    request_type: CodeRequestType
    language: str = Field(..., description="Programming language")
    instruction: str = Field(..., description="What to do")
    context: Dict[str, Any] = Field(default_factory=dict)
    existing_code: Optional[str] = None
    constraints: List[str] = Field(default_factory=list)

    class Config:
        schema_extra = {
            "example": {
                "request_type": "generate",
                "language": "python",
                "instruction": "Create a binary search function",
                "context": {"data_structure": "sorted_list"},
                "constraints": ["Use iterative approach", "Add type hints"]
            }
        }
</code></pre>
<h3 id="response-model"><a class="header" href="#response-model">Response Model</a></h3>
<pre><code class="language-python">class CodeResponse(BaseModel):
    success: bool
    code: str = Field(..., description="Generated/modified code")
    explanation: str
    language: str
    tests: Optional[str] = None
    confidence: float = Field(..., ge=0.0, le=1.0)
    warnings: List[str] = Field(default_factory=list)
    metadata: Dict[str, Any] = Field(default_factory=dict)
</code></pre>
<h3 id="validation-result"><a class="header" href="#validation-result">Validation Result</a></h3>
<pre><code class="language-python">class ValidationResult(BaseModel):
    valid: bool
    message: str
    line: Optional[int] = None
    column: Optional[int] = None
    suggestions: List[str] = Field(default_factory=list)
</code></pre>
<hr />
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<h3 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h3>
<pre><code class="language-bash"># Coder Arm Configuration
CODER_PORT=8004
CODER_MODEL=gpt-4  # or gpt-3.5-turbo for lower cost
CODER_TEMPERATURE=0.2
CODER_MAX_TOKENS=4000

# Memory Configuration
QDRANT_URL=http://qdrant:6333
CODER_MEMORY_COLLECTION=coder_memory
MEMORY_MAX_SOLUTIONS=10000

# OpenAI Configuration
OPENAI_API_KEY=sk-...
OPENAI_ORG_ID=org-...

# Validation
ENABLE_SYNTAX_VALIDATION=true
AUTO_FIX_SYNTAX=true
MAX_FIX_ATTEMPTS=2

# Logging
LOG_LEVEL=info
LOG_CODE_SAMPLES=true
LOG_PROMPTS=false  # Sensitive, disable in prod
</code></pre>
<h3 id="configuration-file"><a class="header" href="#configuration-file">Configuration File</a></h3>
<p><strong>config.yaml</strong>:</p>
<pre><code class="language-yaml">coder_arm:
  model: gpt-4
  temperature: 0.2
  max_tokens: 4000

  # Memory settings
  memory:
    backend: qdrant
    collection: coder_memory
    max_solutions: 10000
    embedding_model: all-MiniLM-L6-v2

  # Validation
  validation:
    enabled: true
    auto_fix: true
    max_attempts: 2

    validators:
      python:
        enabled: true
        linter: pylint
      javascript:
        enabled: true
        linter: eslint
      go:
        enabled: true
        formatter: gofmt

  # Supported languages
  languages:
    - python
    - javascript
    - typescript
    - go
    - rust
    - java
    - cpp
    - csharp
</code></pre>
<hr />
<h2 id="performance-characteristics"><a class="header" href="#performance-characteristics">Performance Characteristics</a></h2>
<h3 id="latency"><a class="header" href="#latency">Latency</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Operation</th><th>P50</th><th>P95</th><th>P99</th></tr></thead><tbody>
<tr><td>Memory search</td><td>50ms</td><td>100ms</td><td>200ms</td></tr>
<tr><td>LLM generation</td><td>2s</td><td>4s</td><td>6s</td></tr>
<tr><td>Syntax validation</td><td>100ms</td><td>300ms</td><td>500ms</td></tr>
<tr><td>Total (generate)</td><td>2.5s</td><td>5s</td><td>8s</td></tr>
<tr><td>Total (debug)</td><td>3s</td><td>6s</td><td>10s</td></tr>
</tbody></table>
</div>
<h3 id="cost"><a class="header" href="#cost">Cost</a></h3>
<ul>
<li><strong>GPT-4 Usage</strong>: ~2,000 tokens per request (input + output)</li>
<li><strong>Monthly Cost</strong>: $0.06 per request (GPT-4 pricing)</li>
<li><strong>Memory Storage</strong>: ~1 KB per solution</li>
<li><strong>Total Cost</strong>: Tier 4 (High)</li>
</ul>
<h3 id="accuracy"><a class="header" href="#accuracy">Accuracy</a></h3>
<ul>
<li><strong>Syntax Valid</strong>: 88% first attempt, 95% after fix</li>
<li><strong>Functionally Correct</strong>: 75-85% (varies by complexity)</li>
<li><strong>Best Practices</strong>: 80% compliance</li>
<li><strong>Memory Hits</strong>: 30-40% of requests find similar solutions</li>
</ul>
<hr />
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<h3 id="unit-tests"><a class="header" href="#unit-tests">Unit Tests</a></h3>
<pre><code class="language-python">import pytest
from coder_arm import CoderArm, CodeRequest, CodeRequestType

@pytest.fixture
async def coder():
    return CoderArm(llm_model="gpt-3.5-turbo")

@pytest.mark.asyncio
async def test_generate_python_function(coder):
    request = CodeRequest(
        request_type=CodeRequestType.GENERATE,
        language="python",
        instruction="Create a fibonacci function",
        constraints=["Use recursion", "Add docstring"]
    )

    response = await coder.process_request(request)

    assert response.success
    assert "def" in response.code
    assert response.language == "python"
    assert response.confidence &gt; 0.7

@pytest.mark.asyncio
async def test_syntax_validation(coder):
    code = "def invalid_function(\n    print('missing closing paren')"

    validation = await coder.validators.validate_syntax(code, "python")

    assert not validation.valid
    assert "SyntaxError" in validation.message

@pytest.mark.asyncio
async def test_memory_storage(coder):
    solution_id = await coder.memory.store_solution(
        instruction="Test function",
        code="def test(): pass",
        language="python",
        metadata={}
    )

    assert solution_id is not None

    results = await coder.memory.search_similar("Test function", language="python")
    assert len(results) &gt; 0
    assert results[0]["code"] == "def test(): pass"
</code></pre>
<h3 id="integration-tests"><a class="header" href="#integration-tests">Integration Tests</a></h3>
<pre><code class="language-python">@pytest.mark.asyncio
async def test_end_to_end_generation(coder):
    """Test full generation pipeline."""

    request = CodeRequest(
        request_type=CodeRequestType.GENERATE,
        language="python",
        instruction="Binary search in sorted array",
        constraints=["Iterative", "Type hints", "Docstring"]
    )

    response = await coder.process_request(request)

    # Verify response
    assert response.success
    assert "def" in response.code
    assert "binary" in response.code.lower()

    # Verify syntax validity
    import ast
    ast.parse(response.code)  # Should not raise

    # Verify memory stored
    similar = await coder.memory.search_similar(
        "Binary search",
        language="python",
        limit=1
    )
    assert len(similar) &gt; 0
</code></pre>
<hr />
<h2 id="deployment"><a class="header" href="#deployment">Deployment</a></h2>
<h3 id="dockerfile"><a class="header" href="#dockerfile">Dockerfile</a></h3>
<pre><code class="language-dockerfile">FROM python:3.11-slim

WORKDIR /app

# Install dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Install syntax validators
RUN pip install pylint eslint-py

# Copy application
COPY coder_arm/ ./coder_arm/
COPY config.yaml .

# Non-root user
RUN useradd -m -u 1000 coder &amp;&amp; chown -R coder:coder /app
USER coder

# Environment
ENV PYTHONUNBUFFERED=1
ENV LOG_LEVEL=info

EXPOSE 8004

CMD ["uvicorn", "coder_arm.main:app", "--host", "0.0.0.0", "--port", "8004"]
</code></pre>
<h3 id="kubernetes-deployment"><a class="header" href="#kubernetes-deployment">Kubernetes Deployment</a></h3>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: coder-arm
  namespace: octollm
spec:
  replicas: 2
  selector:
    matchLabels:
      app: coder-arm
  template:
    metadata:
      labels:
        app: coder-arm
    spec:
      containers:
      - name: coder
        image: octollm/coder-arm:1.0

        ports:
        - containerPort: 8004
          name: http

        env:
        - name: CODER_PORT
          value: "8004"
        - name: CODER_MODEL
          value: "gpt-4"
        - name: QDRANT_URL
          value: "http://qdrant:6333"
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: openai-credentials
              key: api-key

        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "2Gi"
            cpu: "1000m"

        livenessProbe:
          httpGet:
            path: /health
            port: 8004
          initialDelaySeconds: 30
          periodSeconds: 10

        readinessProbe:
          httpGet:
            path: /health
            port: 8004
          initialDelaySeconds: 10
          periodSeconds: 5

---
apiVersion: v1
kind: Service
metadata:
  name: coder-arm
  namespace: octollm
spec:
  selector:
    app: coder-arm
  ports:
  - port: 8004
    targetPort: 8004
    name: http
  type: ClusterIP
</code></pre>
<hr />
<h2 id="supported-languages"><a class="header" href="#supported-languages">Supported Languages</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Language</th><th>Syntax Validator</th><th>Style Guide</th><th>Confidence</th></tr></thead><tbody>
<tr><td><strong>Python</strong></td><td>AST + pylint</td><td>PEP 8</td><td>High (92%)</td></tr>
<tr><td><strong>JavaScript</strong></td><td>ESLint</td><td>Airbnb</td><td>High (90%)</td></tr>
<tr><td><strong>TypeScript</strong></td><td>TSC</td><td>Airbnb</td><td>High (89%)</td></tr>
<tr><td><strong>Go</strong></td><td>gofmt + go vet</td><td>Effective Go</td><td>Medium (85%)</td></tr>
<tr><td><strong>Rust</strong></td><td>rustc</td><td>Rust Style</td><td>Medium (83%)</td></tr>
<tr><td><strong>Java</strong></td><td>javac + Checkstyle</td><td>Google Java</td><td>Medium (82%)</td></tr>
<tr><td><strong>C++</strong></td><td>clang</td><td>Google C++</td><td>Medium (80%)</td></tr>
<tr><td><strong>C#</strong></td><td>Roslyn</td><td>Microsoft C#</td><td>Medium (81%)</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="../orchestrator.html">Orchestrator Component</a> - Task coordination</li>
<li><a href="./planner-arm.html">Planner Arm</a> - Task decomposition</li>
<li><a href="./executor-arm.html">Executor Arm</a> - Code execution</li>
<li><a href="./judge-arm.html">Judge Arm</a> - Code quality validation</li>
<li><a href="../../implementation/memory-systems.html">Memory Systems</a> - Memory architecture</li>
<li><a href="../../api/rest-api.html">API Reference</a> - Complete API documentation</li>
</ul>
<hr />
<p><strong>Document Status</strong>: Phase 1 Complete
<strong>Last Updated</strong>: 2025-11-10
<strong>Maintainer</strong>: OctoLLM Core Team
<strong>Next Review</strong>: 2025-12-10</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../components/arms/retriever-arm.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../components/arms/judge-arm.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../components/arms/retriever-arm.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../components/arms/judge-arm.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
