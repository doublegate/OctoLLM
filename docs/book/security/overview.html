<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Security Overview - OctoLLM Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Distributed AI Architecture for Offensive Security and Developer Tooling - Comprehensive technical documentation covering architecture, API, development, operations, and security.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OctoLLM Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/doublegate/OctoLLM" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/doublegate/OctoLLM/edit/main/docs/src/security/overview.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="octollm-security-architecture-overview"><a class="header" href="#octollm-security-architecture-overview">OctoLLM Security Architecture Overview</a></h1>
<p><strong>Version</strong>: 1.0
<strong>Last Updated</strong>: 2025-11-10
<strong>Classification</strong>: Internal Use</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#executive-summary">Executive Summary</a></li>
<li><a href="#security-principles">Security Principles</a></li>
<li><a href="#threat-model">Threat Model</a></li>
<li><a href="#defense-layers">Defense Layers</a></li>
<li><a href="#security-controls">Security Controls</a></li>
<li><a href="#compliance">Compliance</a></li>
</ul>
<h2 id="executive-summary"><a class="header" href="#executive-summary">Executive Summary</a></h2>
<p>OctoLLM implements defense-in-depth security through capability-based isolation, PII protection, adversarial hardening, and comprehensive audit logging. The architecture treats security as a first-class concern, with multiple overlapping protection layers preventing unauthorized access, data leakage, and system compromise.</p>
<h3 id="security-posture"><a class="header" href="#security-posture">Security Posture</a></h3>
<ul>
<li><strong>Capability-Based Access Control</strong>: Arms operate with minimal necessary privileges</li>
<li><strong>Network Segmentation</strong>: Components isolated in separate network zones</li>
<li><strong>Data Protection</strong>: PII detection and sanitization at all boundaries</li>
<li><strong>Adversarial Testing</strong>: Continuous red-team validation</li>
<li><strong>Audit Logging</strong>: Complete provenance for all actions</li>
<li><strong>Encryption</strong>: TLS for all network communication, at-rest encryption for sensitive data</li>
</ul>
<h2 id="security-principles"><a class="header" href="#security-principles">Security Principles</a></h2>
<h3 id="1-principle-of-least-privilege"><a class="header" href="#1-principle-of-least-privilege">1. Principle of Least Privilege</a></h3>
<p><strong>Every component operates with the minimum permissions required for its function.</strong></p>
<pre><code class="language-mermaid">graph TB
    subgraph "Privilege Levels"
        ORCH[Orchestrator&lt;br/&gt;High Privilege]
        JUDGE[Judge Arm&lt;br/&gt;Medium Privilege]
        RETR[Retriever Arm&lt;br/&gt;Low Privilege]
        EXEC[Executor Arm&lt;br/&gt;Restricted Privilege]
    end

    ORCH --&gt;|Can invoke| JUDGE
    ORCH --&gt;|Can invoke| RETR
    ORCH --&gt;|Can invoke| EXEC

    JUDGE --&gt;|Read-only| RETR
    EXEC --&gt;|Cannot access| JUDGE
    EXEC --&gt;|Cannot access| RETR

    style EXEC fill:#ff9999
    style RETR fill:#ffcc99
    style JUDGE fill:#99ccff
    style ORCH fill:#9999ff
</code></pre>
<p><strong>Implementation</strong>:</p>
<ul>
<li>Executor arm: Allowlisted commands only, no network access to internal services</li>
<li>Retriever arm: Read-only access to knowledge bases</li>
<li>Judge arm: No external network access</li>
<li>Orchestrator: Full coordination privileges, but no direct tool execution</li>
</ul>
<h3 id="2-defense-in-depth"><a class="header" href="#2-defense-in-depth">2. Defense in Depth</a></h3>
<p><strong>Multiple independent security layers protect critical assets.</strong></p>
<pre><code class="language-mermaid">flowchart LR
    INPUT[User Input] --&gt; L1[Layer 1&lt;br/&gt;API Gateway Auth]
    L1 --&gt; L2[Layer 2&lt;br/&gt;Rate Limiting]
    L2 --&gt; L3[Layer 3&lt;br/&gt;Reflex PII Filter]
    L3 --&gt; L4[Layer 4&lt;br/&gt;Injection Detection]
    L4 --&gt; L5[Layer 5&lt;br/&gt;Capability Checks]
    L5 --&gt; L6[Layer 6&lt;br/&gt;Output Validation]
    L6 --&gt; L7[Layer 7&lt;br/&gt;Audit Logging]
    L7 --&gt; PROCESS[Process Request]
</code></pre>
<p><strong>Layers</strong>:</p>
<ol>
<li><strong>API Gateway</strong>: Authentication, TLS termination</li>
<li><strong>Rate Limiting</strong>: Prevent abuse</li>
<li><strong>PII Detection</strong>: Sanitize sensitive data</li>
<li><strong>Injection Detection</strong>: Block adversarial inputs</li>
<li><strong>Capability Isolation</strong>: Enforce privilege boundaries</li>
<li><strong>Output Validation</strong>: Prevent data leakage</li>
<li><strong>Audit Logging</strong>: Complete traceability</li>
</ol>
<h3 id="3-zero-trust-architecture"><a class="header" href="#3-zero-trust-architecture">3. Zero Trust Architecture</a></h3>
<p><strong>Never trust, always verify - even internal components.</strong></p>
<ul>
<li>All inter-component communication requires authentication</li>
<li>No implicit trust between arms</li>
<li>Orchestrator validates all arm responses</li>
<li>Cryptographic signatures on critical artifacts</li>
</ul>
<h2 id="threat-model"><a class="header" href="#threat-model">Threat Model</a></h2>
<h3 id="threat-actors"><a class="header" href="#threat-actors">Threat Actors</a></h3>
<h4 id="external-attackers"><a class="header" href="#external-attackers">External Attackers</a></h4>
<p><strong>Motivation</strong>: Data theft, service disruption, unauthorized access</p>
<p><strong>Capabilities</strong>:</p>
<ul>
<li>Network-level attacks (DDoS, port scanning)</li>
<li>Application-level attacks (injection, XSS)</li>
<li>Social engineering</li>
</ul>
<p><strong>Mitigations</strong>:</p>
<ul>
<li>WAF (Web Application Firewall)</li>
<li>Rate limiting</li>
<li>Input validation</li>
<li>Security monitoring</li>
</ul>
<h4 id="malicious-insiders"><a class="header" href="#malicious-insiders">Malicious Insiders</a></h4>
<p><strong>Motivation</strong>: Data exfiltration, privilege escalation</p>
<p><strong>Capabilities</strong>:</p>
<ul>
<li>Legitimate API access</li>
<li>Knowledge of system internals</li>
<li>Potential access to credentials</li>
</ul>
<p><strong>Mitigations</strong>:</p>
<ul>
<li>Capability isolation</li>
<li>Comprehensive audit logging</li>
<li>Anomaly detection</li>
<li>Regular access reviews</li>
</ul>
<h4 id="compromised-arms"><a class="header" href="#compromised-arms">Compromised Arms</a></h4>
<p><strong>Motivation</strong>: Lateral movement, privilege escalation</p>
<p><strong>Capabilities</strong>:</p>
<ul>
<li>Full control of compromised component</li>
<li>Ability to manipulate outputs</li>
<li>Potential network access</li>
</ul>
<p><strong>Mitigations</strong>:</p>
<ul>
<li>Network segmentation</li>
<li>Capability tokens</li>
<li>Output validation</li>
<li>Anomaly detection</li>
</ul>
<h3 id="attack-vectors"><a class="header" href="#attack-vectors">Attack Vectors</a></h3>
<pre><code class="language-mermaid">graph TB
    subgraph "Attack Surface"
        API[Public API]
        INJECT[Prompt Injection]
        PIVOT[Lateral Movement]
        DATA[Data Exfiltration]
        DOS[Denial of Service]
    end

    API --&gt;|Unauthenticated Access| AUTH[Authentication Layer]
    INJECT --&gt;|Malicious Prompts| REFLEX[Reflex Filter]
    PIVOT --&gt;|Compromised Arm| NETPOL[Network Policies]
    DATA --&gt;|PII Leakage| SANITIZE[PII Sanitization]
    DOS --&gt;|Resource Exhaustion| RATE[Rate Limiting]

    AUTH --&gt;|Mitigates| API
    REFLEX --&gt;|Blocks| INJECT
    NETPOL --&gt;|Prevents| PIVOT
    SANITIZE --&gt;|Redacts| DATA
    RATE --&gt;|Throttles| DOS
</code></pre>
<h2 id="defense-layers"><a class="header" href="#defense-layers">Defense Layers</a></h2>
<h3 id="layer-1-network-perimeter"><a class="header" href="#layer-1-network-perimeter">Layer 1: Network Perimeter</a></h3>
<pre><code class="language-yaml"># Kubernetes NetworkPolicy
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-all
  namespace: octollm
spec:
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress
  # Deny all by default
</code></pre>
<p><strong>Controls</strong>:</p>
<ul>
<li>Default deny all traffic</li>
<li>Explicit allow rules only</li>
<li>Separate zones: Public, DMZ, Application, Data</li>
<li>TLS for all inter-zone communication</li>
</ul>
<h3 id="layer-2-application-authentication"><a class="header" href="#layer-2-application-authentication">Layer 2: Application Authentication</a></h3>
<pre><code class="language-python">from fastapi import Security, HTTPException
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials

security = HTTPBearer()

async def verify_token(credentials: HTTPAuthorizationCredentials = Security(security)):
    """Verify JWT token."""
    token = credentials.credentials

    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
        user_id = payload.get("sub")

        if not user_id:
            raise HTTPException(status_code=401, detail="Invalid token")

        return user_id

    except jwt.JWTError:
        raise HTTPException(status_code=401, detail="Invalid token")
</code></pre>
<p><strong>Controls</strong>:</p>
<ul>
<li>JWT tokens with short expiration (1 hour)</li>
<li>Refresh tokens (7 days)</li>
<li>Token revocation list</li>
<li>API key authentication for service-to-service</li>
</ul>
<h3 id="layer-3-reflex-layer-security"><a class="header" href="#layer-3-reflex-layer-security">Layer 3: Reflex Layer Security</a></h3>
<pre><code class="language-rust">impl ReflexProcessor {
    fn detect_threats(&amp;self, input: &amp;str) -&gt; Vec&lt;ThreatIndicator&gt; {
        let mut threats = Vec::new();

        // 1. Prompt injection
        if self.detect_injection(input).is_some() {
            threats.push(ThreatIndicator::PromptInjection);
        }

        // 2. PII leakage
        if self.contains_pii(input) {
            threats.push(ThreatIndicator::PIIDetected);
        }

        // 3. Malicious patterns
        if self.detect_malicious_patterns(input) {
            threats.push(ThreatIndicator::MaliciousPattern);
        }

        // 4. Excessive size
        if input.len() &gt; MAX_INPUT_SIZE {
            threats.push(ThreatIndicator::ExcessiveSize);
        }

        threats
    }
}</code></pre>
<p><strong>Controls</strong>:</p>
<ul>
<li>Regex-based injection detection</li>
<li>ML-based anomaly detection</li>
<li>PII pattern matching</li>
<li>Input size limits</li>
</ul>
<h3 id="layer-4-capability-based-isolation"><a class="header" href="#layer-4-capability-based-isolation">Layer 4: Capability-Based Isolation</a></h3>
<pre><code class="language-python">class CapabilityToken:
    """Time-limited, non-transferable capability."""

    def __init__(
        self,
        arm_id: str,
        capabilities: List[str],
        valid_until: datetime,
        nonce: str
    ):
        self.arm_id = arm_id
        self.capabilities = capabilities
        self.valid_until = valid_until
        self.nonce = nonce
        self.signature = self._sign()

    def _sign(self) -&gt; str:
        """Cryptographically sign token."""
        message = f"{self.arm_id}:{','.join(self.capabilities)}:{self.valid_until}:{self.nonce}"
        return hmac.new(SECRET_KEY, message.encode(), hashlib.sha256).hexdigest()

    def verify(self) -&gt; bool:
        """Verify token validity."""
        # Check expiration
        if datetime.utcnow() &gt; self.valid_until:
            return False

        # Verify signature
        expected_sig = self._sign()
        return hmac.compare_digest(self.signature, expected_sig)
</code></pre>
<p><strong>Capabilities per Arm</strong>:</p>
<div class="table-wrapper"><table><thead><tr><th>Arm</th><th>Capabilities</th><th>Restrictions</th></tr></thead><tbody>
<tr><td>Executor</td><td><code>shell:read</code>, <code>http:get</code></td><td>Allowlist commands, specific hosts only</td></tr>
<tr><td>Coder</td><td><code>code:generate</code>, <code>code:analyze</code></td><td>No file write, no command execution</td></tr>
<tr><td>Retriever</td><td><code>db:read</code>, <code>vector:search</code></td><td>Read-only, rate limited</td></tr>
<tr><td>Judge</td><td><code>validate</code>, <code>fact_check</code></td><td>No external network</td></tr>
<tr><td>Guardian</td><td><code>pii:detect</code>, <code>safety:check</code></td><td>All inputs, minimal latency</td></tr>
</tbody></table>
</div>
<h3 id="layer-5-data-protection"><a class="header" href="#layer-5-data-protection">Layer 5: Data Protection</a></h3>
<h4 id="pii-detection"><a class="header" href="#pii-detection">PII Detection</a></h4>
<pre><code class="language-python">class PIIDetector:
    """Detect and sanitize PII."""

    PATTERNS = {
        "ssn": r"\b\d{3}-\d{2}-\d{4}\b",
        "credit_card": r"\b\d{4}[-\s]?\d{4}[-\s]?\d{4}[-\s]?\d{4}\b",
        "email": r"\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b",
        "phone": r"\b\+?1?\s*\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}\b",
        "ip_address": r"\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b",
    }

    def detect(self, text: str) -&gt; List[PIIMatch]:
        """Detect PII in text."""
        matches = []

        for pii_type, pattern in self.PATTERNS.items():
            for match in re.finditer(pattern, text):
                matches.append(PIIMatch(
                    type=pii_type,
                    value=match.group(),
                    start=match.start(),
                    end=match.end()
                ))

        return matches

    def sanitize(self, text: str, method="redact") -&gt; str:
        """Sanitize PII."""
        matches = self.detect(text)

        if method == "redact":
            # Replace with placeholder
            for match in sorted(matches, key=lambda m: m.start, reverse=True):
                text = text[:match.start] + f"[{match.type.upper()}-REDACTED]" + text[match.end:]

        elif method == "encrypt":
            # Encrypt PII values
            for match in sorted(matches, key=lambda m: m.start, reverse=True):
                encrypted = encrypt_pii(match.value)
                text = text[:match.start] + encrypted + text[match.end:]

        return text
</code></pre>
<h4 id="data-classification"><a class="header" href="#data-classification">Data Classification</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Classification</th><th>Storage</th><th>Transit</th><th>Processing</th><th>Retention</th></tr></thead><tbody>
<tr><td><strong>Public</strong></td><td>Unencrypted</td><td>TLS</td><td>No restrictions</td><td>Unlimited</td></tr>
<tr><td><strong>Internal</strong></td><td>Encrypted at rest</td><td>TLS</td><td>Audit logged</td><td>90 days</td></tr>
<tr><td><strong>Confidential</strong></td><td>Encrypted + access control</td><td>TLS 1.3</td><td>Audit + approval</td><td>30 days</td></tr>
<tr><td><strong>Secret</strong></td><td>HSM/Vault</td><td>TLS 1.3 + mutual auth</td><td>Encrypted processing</td><td>7 days</td></tr>
</tbody></table>
</div>
<h3 id="layer-6-output-validation"><a class="header" href="#layer-6-output-validation">Layer 6: Output Validation</a></h3>
<pre><code class="language-python">class OutputValidator:
    """Validate arm outputs before returning to user."""

    def validate(self, output: Dict[str, Any], task: TaskContract) -&gt; ValidationResult:
        """Multi-stage validation."""

        # 1. Schema validation
        if not self._validate_schema(output):
            return ValidationResult(valid=False, reason="Invalid schema")

        # 2. PII check
        if self._contains_pii(output):
            return ValidationResult(valid=False, reason="PII detected in output")

        # 3. Injection check
        if self._contains_injection(output):
            return ValidationResult(valid=False, reason="Potential injection in output")

        # 4. Acceptance criteria
        if not self._meets_criteria(output, task.acceptance_criteria):
            return ValidationResult(valid=False, reason="Acceptance criteria not met")

        # 5. Hallucination check
        confidence = self._check_hallucination(output)
        if confidence &lt; 0.7:
            return ValidationResult(valid=False, reason="Low confidence, possible hallucination")

        return ValidationResult(valid=True)
</code></pre>
<h3 id="layer-7-audit-logging"><a class="header" href="#layer-7-audit-logging">Layer 7: Audit Logging</a></h3>
<pre><code class="language-python">import structlog

logger = structlog.get_logger()

class AuditLogger:
    """Comprehensive audit trail."""

    def log_action(
        self,
        action_type: str,
        actor: str,
        resource: str,
        result: str,
        metadata: Dict[str, Any]
    ):
        """Log security-relevant action."""

        logger.info(
            "security.audit",
            action_type=action_type,
            actor=actor,
            resource=resource,
            result=result,
            timestamp=datetime.utcnow().isoformat(),
            trace_id=get_trace_id(),
            **metadata
        )

        # Also write to tamper-proof audit store
        self._write_to_audit_store({
            "action_type": action_type,
            "actor": actor,
            "resource": resource,
            "result": result,
            "timestamp": datetime.utcnow(),
            "metadata": metadata
        })

# Usage
audit = AuditLogger()

audit.log_action(
    action_type="task.execute",
    actor="user-123",
    resource="task-abc",
    result="success",
    metadata={
        "task_type": "code_generation",
        "duration_ms": 2500,
        "tokens_used": 350
    }
)
</code></pre>
<p><strong>Audit Events</strong>:</p>
<ul>
<li>Authentication attempts (success/failure)</li>
<li>Task submissions and completions</li>
<li>Arm invocations</li>
<li>Capability grant/revoke</li>
<li>Data access (read/write)</li>
<li>Configuration changes</li>
<li>Security policy violations</li>
</ul>
<h2 id="security-controls"><a class="header" href="#security-controls">Security Controls</a></h2>
<h3 id="authentication"><a class="header" href="#authentication">Authentication</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Use Case</th><th>Strength</th><th>Limitations</th></tr></thead><tbody>
<tr><td>JWT</td><td>User API access</td><td>High</td><td>Requires secure storage</td></tr>
<tr><td>API Key</td><td>Service-to-service</td><td>Medium</td><td>No user context</td></tr>
<tr><td>Mutual TLS</td><td>Internal components</td><td>Very High</td><td>Complex setup</td></tr>
<tr><td>OIDC/OAuth2</td><td>Enterprise SSO</td><td>High</td><td>External dependency</td></tr>
</tbody></table>
</div>
<h3 id="authorization"><a class="header" href="#authorization">Authorization</a></h3>
<pre><code class="language-python">from enum import Enum

class Permission(str, Enum):
    TASK_SUBMIT = "task:submit"
    TASK_READ = "task:read"
    TASK_CANCEL = "task:cancel"
    ARM_INVOKE = "arm:invoke"
    CONFIG_READ = "config:read"
    CONFIG_WRITE = "config:write"
    ADMIN = "admin:*"

class Role:
    USER = [
        Permission.TASK_SUBMIT,
        Permission.TASK_READ,
        Permission.TASK_CANCEL
    ]

    OPERATOR = USER + [
        Permission.CONFIG_READ
    ]

    ADMIN = OPERATOR + [
        Permission.ARM_INVOKE,
        Permission.CONFIG_WRITE,
        Permission.ADMIN
    ]
</code></pre>
<h3 id="encryption"><a class="header" href="#encryption">Encryption</a></h3>
<p><strong>In Transit</strong>:</p>
<ul>
<li>TLS 1.3 minimum</li>
<li>Strong cipher suites only (AES-256-GCM)</li>
<li>Perfect forward secrecy (ECDHE)</li>
<li>Mutual TLS for internal services</li>
</ul>
<p><strong>At Rest</strong>:</p>
<ul>
<li>AES-256 encryption for PostgreSQL</li>
<li>Redis encryption via disk encryption</li>
<li>Secrets in HashiCorp Vault or Kubernetes Secrets</li>
</ul>
<h3 id="secrets-management"><a class="header" href="#secrets-management">Secrets Management</a></h3>
<pre><code class="language-yaml"># Kubernetes Secret (encrypted at rest)
apiVersion: v1
kind: Secret
metadata:
  name: llm-api-keys
  namespace: octollm
type: Opaque
data:
  openai-key: &lt;base64-encoded-key&gt;
  anthropic-key: &lt;base64-encoded-key&gt;
</code></pre>
<p><strong>Best Practices</strong>:</p>
<ul>
<li>Never commit secrets to version control</li>
<li>Rotate secrets every 90 days</li>
<li>Use separate secrets per environment</li>
<li>Audit secret access</li>
<li>Use workload identity when possible</li>
</ul>
<h2 id="compliance"><a class="header" href="#compliance">Compliance</a></h2>
<h3 id="soc-2-type-ii"><a class="header" href="#soc-2-type-ii">SOC 2 Type II</a></h3>
<p><strong>Required Controls</strong>:</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
Access control and authentication</li>
<li><input disabled="" type="checkbox" checked=""/>
Encryption in transit and at rest</li>
<li><input disabled="" type="checkbox" checked=""/>
Audit logging (immutable)</li>
<li><input disabled="" type="checkbox" checked=""/>
Change management process</li>
<li><input disabled="" type="checkbox" checked=""/>
Incident response plan</li>
<li><input disabled="" type="checkbox" checked=""/>
Backup and recovery procedures</li>
<li><input disabled="" type="checkbox" checked=""/>
Security monitoring and alerting</li>
</ul>
<h3 id="iso-27001"><a class="header" href="#iso-27001">ISO 27001</a></h3>
<p><strong>Information Security Management</strong>:</p>
<ul>
<li>Risk assessment (quarterly)</li>
<li>Security policies and procedures</li>
<li>Access control policy</li>
<li>Cryptography policy</li>
<li>Incident management</li>
<li>Business continuity plan</li>
</ul>
<h3 id="gdpr-compliance"><a class="header" href="#gdpr-compliance">GDPR Compliance</a></h3>
<p><strong>Data Protection Measures</strong>:</p>
<ul>
<li>PII detection and redaction</li>
<li>Data minimization (30-day retention)</li>
<li>Right to erasure (delete API)</li>
<li>Data portability (export API)</li>
<li>Consent management</li>
<li>Data breach notification (&lt; 72 hours)</li>
</ul>
<h3 id="hipaa-if-applicable"><a class="header" href="#hipaa-if-applicable">HIPAA (if applicable)</a></h3>
<p><strong>Protected Health Information</strong>:</p>
<ul>
<li>Additional PII patterns for PHI</li>
<li>Access controls and audit logs</li>
<li>Encryption requirements</li>
<li>Business associate agreements</li>
</ul>
<h2 id="incident-response"><a class="header" href="#incident-response">Incident Response</a></h2>
<h3 id="severity-levels"><a class="header" href="#severity-levels">Severity Levels</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Level</th><th>Description</th><th>Response Time</th><th>Examples</th></tr></thead><tbody>
<tr><td>P0 - Critical</td><td>Data breach, system compromise</td><td>&lt; 15 min</td><td>PII leaked, unauthorized access</td></tr>
<tr><td>P1 - High</td><td>Service disruption, vulnerability</td><td>&lt; 1 hour</td><td>DDoS attack, injection bypass</td></tr>
<tr><td>P2 - Medium</td><td>Degraded service, minor vulnerability</td><td>&lt; 4 hours</td><td>Performance issues, config error</td></tr>
<tr><td>P3 - Low</td><td>Minor issues, questions</td><td>&lt; 24 hours</td><td>Documentation, feature request</td></tr>
</tbody></table>
</div>
<h3 id="incident-response-plan"><a class="header" href="#incident-response-plan">Incident Response Plan</a></h3>
<pre><code class="language-mermaid">flowchart TD
    DETECT[Incident Detected] --&gt; ASSESS[Assess Severity]
    ASSESS --&gt; NOTIFY{Severity?}

    NOTIFY --&gt;|P0/P1| ESCALATE[Escalate to Security Team]
    NOTIFY --&gt;|P2/P3| TICKET[Create Ticket]

    ESCALATE --&gt; CONTAIN[Contain Incident]
    CONTAIN --&gt; INVESTIGATE[Investigate Root Cause]
    INVESTIGATE --&gt; REMEDIATE[Remediate Vulnerability]
    REMEDIATE --&gt; VERIFY[Verify Fix]
    VERIFY --&gt; DOCUMENT[Document Incident]
    DOCUMENT --&gt; REVIEW[Post-Incident Review]

    TICKET --&gt; INVESTIGATE
</code></pre>
<h2 id="security-testing"><a class="header" href="#security-testing">Security Testing</a></h2>
<h3 id="penetration-testing"><a class="header" href="#penetration-testing">Penetration Testing</a></h3>
<p><strong>Frequency</strong>: Quarterly</p>
<p><strong>Scope</strong>:</p>
<ul>
<li>External API endpoints</li>
<li>Authentication/authorization</li>
<li>Injection attacks</li>
<li>Privilege escalation</li>
<li>Data leakage</li>
</ul>
<p><strong>Tools</strong>:</p>
<ul>
<li>OWASP ZAP</li>
<li>Burp Suite</li>
<li>Nuclei</li>
<li>Custom scripts</li>
</ul>
<h3 id="vulnerability-scanning"><a class="header" href="#vulnerability-scanning">Vulnerability Scanning</a></h3>
<p><strong>Frequency</strong>: Weekly</p>
<p><strong>Tools</strong>:</p>
<ul>
<li>Snyk (dependency scanning)</li>
<li>Trivy (container scanning)</li>
<li>SonarQube (static analysis)</li>
<li>Bandit (Python security linter)</li>
</ul>
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="./threat-model.html">Threat Model</a></li>
<li><a href="./capability-isolation.html">Capability Isolation</a></li>
<li><a href="./pii-protection.html">PII Protection</a></li>
<li><a href="./security-testing.html">Security Testing</a></li>
<li><a href="./compliance.html">Compliance Guide</a></li>
<li><a href="./incident-response.html">Incident Response Runbook</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../operations/kubernetes-access.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../security/threat-model.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../operations/kubernetes-access.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../security/threat-model.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
