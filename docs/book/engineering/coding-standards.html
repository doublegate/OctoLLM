<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Coding Standards - OctoLLM Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Distributed AI Architecture for Offensive Security and Developer Tooling - Comprehensive technical documentation covering architecture, API, development, operations, and security.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OctoLLM Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/doublegate/OctoLLM" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/doublegate/OctoLLM/edit/main/docs/src/engineering/coding-standards.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="coding-standards"><a class="header" href="#coding-standards">Coding Standards</a></h1>
<p><strong>Last Updated</strong>: 2025-11-10
<strong>Status</strong>: Production Standard
<strong>Applies To</strong>: All OctoLLM codebase (Python, Rust)</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>This document defines coding standards for the OctoLLM project to ensure consistency, maintainability, and quality across the codebase. These standards apply to all contributors and are enforced through automated tooling and code reviews.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#python-standards">Python Standards</a></li>
<li><a href="#rust-standards">Rust Standards</a></li>
<li><a href="#general-standards">General Standards</a></li>
<li><a href="#documentation-standards">Documentation Standards</a></li>
<li><a href="#testing-standards">Testing Standards</a></li>
<li><a href="#git-commit-standards">Git Commit Standards</a></li>
<li><a href="#automated-enforcement">Automated Enforcement</a></li>
</ul>
<hr />
<h2 id="python-standards"><a class="header" href="#python-standards">Python Standards</a></h2>
<h3 id="style-guide"><a class="header" href="#style-guide">Style Guide</a></h3>
<p>Follow <a href="https://peps.python.org/pep-0008/">PEP 8</a> with the following specific requirements:</p>
<p><strong>Line Length</strong>:</p>
<pre><code class="language-python"># Maximum 100 characters per line (not PEP 8's 79)
# For better readability on modern displays
MAX_LINE_LENGTH = 100
</code></pre>
<p><strong>Imports</strong>:</p>
<pre><code class="language-python"># Group imports in this order:
# 1. Standard library
# 2. Third-party packages
# 3. Local application imports

import asyncio
import logging
from typing import List, Optional, Dict, Any

import httpx
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel, Field

from octollm.models import TaskContract
from octollm.utils import generate_id
</code></pre>
<p><strong>Type Hints</strong>:</p>
<pre><code class="language-python"># ALWAYS use type hints for function signatures
from typing import List, Dict, Optional, Any, Union

# Good
async def get_task(task_id: str) -&gt; Optional[TaskContract]:
    """Retrieve a task by ID."""
    return await db.get_task(task_id)

# Bad - no type hints
async def get_task(task_id):
    return await db.get_task(task_id)

# Use TypedDict for complex dictionaries
from typing import TypedDict

class TaskData(TypedDict):
    task_id: str
    status: str
    result: Optional[Dict[str, Any]]

# Prefer Pydantic models for validation
from pydantic import BaseModel

class TaskContract(BaseModel):
    task_id: str
    description: str
    priority: int = Field(default=5, ge=1, le=10)
</code></pre>
<p><strong>Async/Await</strong>:</p>
<pre><code class="language-python"># Use async/await consistently
# Prefix async functions with "async_" if mixing sync/async

# Good
async def fetch_data() -&gt; Dict[str, Any]:
    async with httpx.AsyncClient() as client:
        response = await client.get("http://api.example.com/data")
        return response.json()

# For mixed codebases, be explicit
async def async_process_task(task: TaskContract) -&gt; str:
    result = await fetch_data()
    return sync_format_result(result)

def sync_format_result(data: Dict[str, Any]) -&gt; str:
    return json.dumps(data, indent=2)
</code></pre>
<p><strong>Class Definitions</strong>:</p>
<pre><code class="language-python"># Use dataclasses for simple data structures
from dataclasses import dataclass, field
from typing import List

@dataclass
class ArmCapability:
    """Represents an arm's capabilities."""

    name: str
    description: str
    tags: List[str] = field(default_factory=list)
    enabled: bool = True

    def matches_tag(self, tag: str) -&gt; bool:
        """Check if capability matches a tag."""
        return tag.lower() in [t.lower() for t in self.tags]

# Use Pydantic for validation and API models
from pydantic import BaseModel, Field, validator

class TaskRequest(BaseModel):
    """Request model for task creation."""

    description: str = Field(..., min_length=10, max_length=10000)
    priority: int = Field(default=5, ge=1, le=10)
    timeout: int = Field(default=300, gt=0, le=3600)

    @validator('description')
    def description_not_empty(cls, v: str) -&gt; str:
        """Ensure description is not just whitespace."""
        if not v.strip():
            raise ValueError("Description cannot be empty")
        return v.strip()
</code></pre>
<p><strong>Error Handling</strong>:</p>
<pre><code class="language-python"># Use specific exceptions, not bare except
# Create custom exceptions for domain errors

class OctoLLMException(Exception):
    """Base exception for OctoLLM errors."""
    pass

class TaskNotFoundError(OctoLLMException):
    """Task not found in database."""
    pass

class ArmUnavailableError(OctoLLMException):
    """No suitable arm available for task."""
    pass

# Good error handling
async def get_task(task_id: str) -&gt; TaskContract:
    try:
        task = await db.query_task(task_id)
        if not task:
            raise TaskNotFoundError(f"Task {task_id} not found")
        return task
    except asyncpg.PostgresError as e:
        logger.error("Database error", task_id=task_id, error=str(e))
        raise OctoLLMException("Failed to retrieve task") from e

# Bad - catches everything
try:
    task = await db.query_task(task_id)
except Exception:
    return None
</code></pre>
<p><strong>Logging</strong>:</p>
<pre><code class="language-python"># Use structured logging with context
import structlog

logger = structlog.get_logger(__name__)

# Good - structured with context
async def process_task(task: TaskContract) -&gt; str:
    logger.info(
        "task.processing.started",
        task_id=task.task_id,
        priority=task.priority,
        user_id=task.user_id
    )

    try:
        result = await execute_task(task)
        logger.info(
            "task.processing.completed",
            task_id=task.task_id,
            duration_ms=result.duration
        )
        return result.output
    except Exception as e:
        logger.error(
            "task.processing.failed",
            task_id=task.task_id,
            error=str(e),
            exc_info=True
        )
        raise

# Bad - unstructured logging
logging.info(f"Processing task {task.task_id}")
</code></pre>
<p><strong>Docstrings</strong>:</p>
<pre><code class="language-python"># Use Google-style docstrings
def calculate_routing_score(
    task: TaskContract,
    capability: ArmCapability
) -&gt; float:
    """Calculate routing score for arm selection.

    Args:
        task: The task to route
        capability: The arm capability to evaluate

    Returns:
        Score between 0.0 and 1.0, where higher is better match

    Raises:
        ValueError: If task or capability is invalid

    Example:
        &gt;&gt;&gt; task = TaskContract(description="Write Python code")
        &gt;&gt;&gt; capability = ArmCapability(name="coder", tags=["python"])
        &gt;&gt;&gt; score = calculate_routing_score(task, capability)
        &gt;&gt;&gt; assert 0.0 &lt;= score &lt;= 1.0
    """
    if not task.description:
        raise ValueError("Task description cannot be empty")

    score = 0.0
    for tag in capability.tags:
        if tag.lower() in task.description.lower():
            score += 0.2

    return min(score, 1.0)
</code></pre>
<p><strong>Code Organization</strong>:</p>
<pre><code class="language-python"># Organize modules by feature, not by type
# Good structure:
octollm/
├── orchestrator/
│   ├── __init__.py
│   ├── planner.py       # Task planning logic
│   ├── router.py        # Arm routing logic
│   ├── models.py        # Orchestrator models
│   └── api.py           # FastAPI endpoints
├── arms/
│   ├── __init__.py
│   ├── base.py          # Base arm interface
│   ├── planner/
│   ├── coder/
│   └── judge/
└── memory/
    ├── __init__.py
    ├── global_memory.py
    ├── local_memory.py
    └── router.py

# Each module should have clear responsibilities
# Keep functions focused and small (&lt; 50 lines)
</code></pre>
<h3 id="tools-configuration"><a class="header" href="#tools-configuration">Tools Configuration</a></h3>
<p><strong>pyproject.toml</strong> (Black, isort, mypy):</p>
<pre><code class="language-toml">[tool.black]
line-length = 100
target-version = ['py311']
include = '\.pyi?$'

[tool.isort]
profile = "black"
line_length = 100
multi_line_output = 3
include_trailing_comma = true

[tool.mypy]
python_version = "3.11"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
check_untyped_defs = true
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_no_return = true
strict_equality = true

[[tool.mypy.overrides]]
module = "tests.*"
disallow_untyped_defs = false

[tool.ruff]
line-length = 100
target-version = "py311"
select = [
    "E",    # pycodestyle errors
    "F",    # pyflakes
    "I",    # isort
    "B",    # flake8-bugbear
    "C4",   # flake8-comprehensions
    "UP",   # pyupgrade
    "ARG",  # flake8-unused-arguments
    "SIM",  # flake8-simplify
]
ignore = [
    "E501",  # line too long (handled by black)
    "B008",  # function call in argument defaults
]

[tool.pytest.ini_options]
asyncio_mode = "auto"
testpaths = ["tests"]
python_files = "test_*.py"
python_classes = "Test*"
python_functions = "test_*"
addopts = "-v --strict-markers --cov=octollm --cov-report=term-missing"
</code></pre>
<p><strong>.pre-commit-config.yaml</strong>:</p>
<pre><code class="language-yaml">repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
      - id: check-added-large-files
      - id: check-merge-conflict

  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black

  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort

  - repo: https://github.com/charliermarsh/ruff-pre-commit
    rev: v0.1.9
    hooks:
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        additional_dependencies: [types-all]
</code></pre>
<hr />
<h2 id="rust-standards"><a class="header" href="#rust-standards">Rust Standards</a></h2>
<h3 id="style-guide-1"><a class="header" href="#style-guide-1">Style Guide</a></h3>
<p>Follow the <a href="https://doc.rust-lang.org/style-guide/">Rust Style Guide</a> with <code>rustfmt</code> defaults.</p>
<p><strong>Naming Conventions</strong>:</p>
<pre><code class="language-rust">// Snake case for variables and functions
let task_id = generate_id();
fn process_request(input: &amp;str) -&gt; Result&lt;String, Error&gt; { }

// CamelCase for types
struct TaskContract { }
enum TaskStatus { }
trait ArmCapability { }

// SCREAMING_SNAKE_CASE for constants
const MAX_RETRIES: u32 = 3;
const DEFAULT_TIMEOUT: Duration = Duration::from_secs(30);</code></pre>
<p><strong>Error Handling</strong>:</p>
<pre><code class="language-rust">// Use Result for recoverable errors
use thiserror::Error;

#[derive(Error, Debug)]
pub enum ReflexError {
    #[error("PII detected in input: {pattern}")]
    PiiDetected { pattern: String },

    #[error("Rate limit exceeded: {limit} req/s")]
    RateLimitExceeded { limit: u32 },

    #[error("Cache error: {0}")]
    CacheError(#[from] redis::RedisError),
}

// Use ? operator for error propagation
async fn preprocess(input: &amp;str) -&gt; Result&lt;String, ReflexError&gt; {
    let sanitized = detect_pii(input)?;
    let cached = cache.get(&amp;sanitized).await?;
    Ok(cached.unwrap_or_else(|| sanitized))
}

// Avoid unwrap() in production code
// Good
match result {
    Ok(value) =&gt; process(value),
    Err(e) =&gt; {
        error!("Processing failed: {}", e);
        return Err(e);
    }
}

// Bad
let value = result.unwrap();</code></pre>
<p><strong>Async/Await</strong>:</p>
<pre><code class="language-rust">// Use tokio for async runtime
use tokio::time::{sleep, Duration};

#[tokio::main]
async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let server = start_server().await?;
    server.await?;
    Ok(())
}

// Use async fn for async functions
async fn fetch_data(url: &amp;str) -&gt; Result&lt;String, reqwest::Error&gt; {
    let response = reqwest::get(url).await?;
    response.text().await
}

// Use async blocks for complex logic
let future = async {
    let data1 = fetch_data("http://api1.com").await?;
    let data2 = fetch_data("http://api2.com").await?;
    Ok::&lt;_, Error&gt;(merge(data1, data2))
};</code></pre>
<p><strong>Traits and Generics</strong>:</p>
<pre><code class="language-rust">// Define traits for shared behavior
pub trait ArmInterface {
    async fn execute(&amp;self, task: TaskContract) -&gt; Result&lt;String, ArmError&gt;;
    async fn health_check(&amp;self) -&gt; HealthStatus;
    fn capabilities(&amp;self) -&gt; &amp;[Capability];
}

// Use generics with trait bounds
pub struct Router&lt;T: ArmInterface&gt; {
    arms: Vec&lt;T&gt;,
}

impl&lt;T: ArmInterface&gt; Router&lt;T&gt; {
    pub async fn route(&amp;self, task: &amp;TaskContract) -&gt; Result&lt;&amp;T, RouterError&gt; {
        for arm in &amp;self.arms {
            if arm.capabilities().iter().any(|c| c.matches(task)) {
                return Ok(arm);
            }
        }
        Err(RouterError::NoMatchingArm)
    }
}</code></pre>
<p><strong>Documentation</strong>:</p>
<pre><code class="language-rust">/// Process a task through the reflex layer.
///
/// This function performs PII detection, rate limiting, and caching
/// before forwarding the task to the orchestrator.
///
/// # Arguments
///
/// * `input` - The raw task input from the user
/// * `config` - Reflex layer configuration
///
/// # Returns
///
/// * `Ok(String)` - Sanitized and validated input
/// * `Err(ReflexError)` - If validation fails
///
/// # Errors
///
/// Returns `ReflexError::PiiDetected` if PII is found and cannot be sanitized.
/// Returns `ReflexError::RateLimitExceeded` if rate limit is exceeded.
///
/// # Example
///
/// ```
/// use reflex::{preprocess, Config};
///
/// let config = Config::default();
/// let result = preprocess("Hello world", &amp;config).await?;
/// assert_eq!(result, "Hello world");
/// ```
pub async fn preprocess(
    input: &amp;str,
    config: &amp;Config,
) -&gt; Result&lt;String, ReflexError&gt; {
    // Implementation
}</code></pre>
<p><strong>Module Organization</strong>:</p>
<pre><code class="language-rust">// src/lib.rs - Public API
pub mod config;
pub mod error;
pub mod pii;
pub mod rate_limit;
pub mod cache;

pub use config::Config;
pub use error::ReflexError;

// src/pii.rs - PII detection module
use regex::Regex;
use once_cell::sync::Lazy;

static EMAIL_PATTERN: Lazy&lt;Regex&gt; = Lazy::new(|| {
    Regex::new(r"\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b").unwrap()
});

pub struct PiiDetector {
    patterns: Vec&lt;Regex&gt;,
}

impl PiiDetector {
    pub fn new() -&gt; Self {
        Self {
            patterns: vec![EMAIL_PATTERN.clone()],
        }
    }

    pub fn detect(&amp;self, text: &amp;str) -&gt; Vec&lt;String&gt; {
        // Implementation
    }
}</code></pre>
<h3 id="tools-configuration-1"><a class="header" href="#tools-configuration-1">Tools Configuration</a></h3>
<p><strong>Cargo.toml</strong>:</p>
<pre><code class="language-toml">[package]
name = "octollm-reflex"
version = "0.1.0"
edition = "2021"
rust-version = "1.75"

[dependencies]
tokio = { version = "1.35", features = ["full"] }
serde = { version = "1.0", features = ["derive"] }
thiserror = "1.0"
tracing = "0.1"
regex = "1.10"

[dev-dependencies]
tokio-test = "0.4"
mockall = "0.12"

[profile.release]
opt-level = 3
lto = true
codegen-units = 1
</code></pre>
<p><strong>rustfmt.toml</strong>:</p>
<pre><code class="language-toml">max_width = 100
hard_tabs = false
tab_spaces = 4
edition = "2021"
use_small_heuristics = "Max"
fn_call_width = 80
struct_lit_width = 80
imports_granularity = "Crate"
group_imports = "StdExternalCrate"
</code></pre>
<p><strong>clippy.toml</strong>:</p>
<pre><code class="language-toml"># Deny warnings in CI
warn-on-all-wildcard-imports = true
</code></pre>
<p><strong>.cargo/config.toml</strong>:</p>
<pre><code class="language-toml">[build]
rustflags = ["-D", "warnings"]

[target.x86_64-unknown-linux-gnu]
linker = "clang"
rustflags = ["-C", "link-arg=-fuse-ld=lld"]
</code></pre>
<hr />
<h2 id="general-standards"><a class="header" href="#general-standards">General Standards</a></h2>
<h3 id="naming-conventions"><a class="header" href="#naming-conventions">Naming Conventions</a></h3>
<p><strong>Files</strong>:</p>
<ul>
<li>Python: <code>snake_case.py</code> (e.g., <code>task_router.py</code>)</li>
<li>Rust: <code>snake_case.rs</code> (e.g., <code>pii_detector.rs</code>)</li>
<li>Configuration: <code>kebab-case.yml</code> (e.g., <code>docker-compose.yml</code>)</li>
</ul>
<p><strong>Variables</strong>:</p>
<ul>
<li>Descriptive names, avoid abbreviations</li>
<li>Good: <code>task_id</code>, <code>user_request</code>, <code>arm_capability</code></li>
<li>Bad: <code>tid</code>, <code>req</code>, <code>cap</code></li>
</ul>
<p><strong>Functions</strong>:</p>
<ul>
<li>Verb-based names indicating action</li>
<li>Good: <code>process_task()</code>, <code>validate_input()</code>, <code>calculate_score()</code></li>
<li>Bad: <code>task()</code>, <code>input()</code>, <code>score()</code></li>
</ul>
<p><strong>Classes</strong>:</p>
<ul>
<li>Noun-based names indicating entity</li>
<li>Good: <code>TaskRouter</code>, <code>ArmCapability</code>, <code>MemoryClient</code></li>
<li>Bad: <code>ProcessTask</code>, <code>DoValidation</code>, <code>GetMemory</code></li>
</ul>
<h3 id="code-complexity"><a class="header" href="#code-complexity">Code Complexity</a></h3>
<p><strong>Function Length</strong>:</p>
<ul>
<li>Target: &lt; 50 lines</li>
<li>Maximum: 100 lines</li>
<li>Extract helper functions if exceeding limits</li>
</ul>
<p><strong>Cyclomatic Complexity</strong>:</p>
<ul>
<li>Target: &lt; 10</li>
<li>Maximum: 15</li>
<li>Refactor complex conditionals into separate functions</li>
</ul>
<p><strong>Nesting Depth</strong>:</p>
<ul>
<li>Target: &lt; 3 levels</li>
<li>Maximum: 4 levels</li>
<li>Use early returns and guard clauses</li>
</ul>
<pre><code class="language-python"># Good - early returns
def process_task(task: Optional[TaskContract]) -&gt; str:
    if not task:
        return "No task provided"

    if not task.description:
        return "No description"

    return execute_task(task)

# Bad - deep nesting
def process_task(task):
    if task:
        if task.description:
            return execute_task(task)
        else:
            return "No description"
    else:
        return "No task provided"
</code></pre>
<h3 id="performance-considerations"><a class="header" href="#performance-considerations">Performance Considerations</a></h3>
<p><strong>Database Queries</strong>:</p>
<pre><code class="language-python"># Good - single query with join
tasks = await db.query("""
    SELECT t.*, u.name as user_name
    FROM tasks t
    JOIN users u ON t.user_id = u.id
    WHERE t.status = $1
""", "pending")

# Bad - N+1 queries
tasks = await db.query("SELECT * FROM tasks WHERE status = $1", "pending")
for task in tasks:
    user = await db.query("SELECT name FROM users WHERE id = $1", task.user_id)
</code></pre>
<p><strong>Async Operations</strong>:</p>
<pre><code class="language-python"># Good - concurrent execution
results = await asyncio.gather(
    fetch_data_1(),
    fetch_data_2(),
    fetch_data_3()
)

# Bad - sequential execution
result1 = await fetch_data_1()
result2 = await fetch_data_2()
result3 = await fetch_data_3()
</code></pre>
<p><strong>Caching</strong>:</p>
<pre><code class="language-python">from cachetools import TTLCache

# Use caching for expensive operations
cache = TTLCache(maxsize=1000, ttl=3600)

async def get_arm_capabilities(arm_id: str) -&gt; List[Capability]:
    if arm_id in cache:
        return cache[arm_id]

    capabilities = await db.fetch_capabilities(arm_id)
    cache[arm_id] = capabilities
    return capabilities
</code></pre>
<hr />
<h2 id="documentation-standards"><a class="header" href="#documentation-standards">Documentation Standards</a></h2>
<h3 id="code-comments"><a class="header" href="#code-comments">Code Comments</a></h3>
<p><strong>When to Comment</strong>:</p>
<ul>
<li>Complex algorithms that aren't self-explanatory</li>
<li>Business logic that requires context</li>
<li>Workarounds for bugs or limitations</li>
<li>Performance-critical sections</li>
</ul>
<p><strong>When NOT to Comment</strong>:</p>
<ul>
<li>Obvious code (don't state what code does, explain why)</li>
<li>Redundant information already in function names</li>
</ul>
<pre><code class="language-python"># Good
# Use exponential backoff to avoid overwhelming the API
# after transient failures (rate limits, temporary outages)
for attempt in range(MAX_RETRIES):
    try:
        return await api_client.call()
    except TransientError:
        await asyncio.sleep(2 ** attempt)

# Bad
# Loop 3 times
for attempt in range(3):
    # Try to call API
    return await api_client.call()
</code></pre>
<h3 id="readme-files"><a class="header" href="#readme-files">README Files</a></h3>
<p>Every module/package should have a README.md:</p>
<pre><code class="language-markdown"># Module Name

Brief description of what this module does.

## Purpose

Detailed explanation of the module's role in the system.

## Components

- `file1.py`: Description
- `file2.py`: Description

## Usage

```python
from module import Component

component = Component()
result = component.process()
</code></pre>
<h2 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h2>
<ul>
<li>dependency1: Why needed</li>
<li>dependency2: Why needed</li>
</ul>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<pre><code class="language-bash">pytest tests/test_module.py
</code></pre>
<pre><code>
---

## Testing Standards

### Test Coverage

- **Unit Tests**: 80-95% coverage
- **Integration Tests**: Critical paths covered
- **E2E Tests**: Key workflows covered

### Test Organization

```python
# tests/test_orchestrator.py
import pytest
from octollm.orchestrator import Orchestrator

class TestOrchestrator:
    """Test suite for Orchestrator component."""

    @pytest.fixture
    def orchestrator(self):
        """Provide orchestrator instance for tests."""
        return Orchestrator(config=test_config)

    def test_plan_simple_task(self, orchestrator):
        """Test planning for a simple task."""
        task = TaskContract(description="List files")
        plan = orchestrator.plan(task)

        assert len(plan.steps) == 1
        assert plan.steps[0].arm == "executor"

    @pytest.mark.asyncio
    async def test_execute_task_success(self, orchestrator):
        """Test successful task execution."""
        task = TaskContract(description="Write hello world")
        result = await orchestrator.execute(task)

        assert result.status == "completed"
        assert "hello world" in result.output.lower()
</code></pre>
<h3 id="test-naming"><a class="header" href="#test-naming">Test Naming</a></h3>
<ul>
<li>Test file: <code>test_&lt;module&gt;.py</code></li>
<li>Test class: <code>Test&lt;Component&gt;</code></li>
<li>Test method: <code>test_&lt;what&gt;_&lt;condition&gt;_&lt;expected&gt;</code></li>
</ul>
<p>Examples:</p>
<ul>
<li><code>test_plan_complex_task_returns_multiple_steps</code></li>
<li><code>test_route_invalid_task_raises_error</code></li>
<li><code>test_cache_miss_fetches_from_database</code></li>
</ul>
<hr />
<h2 id="git-commit-standards"><a class="header" href="#git-commit-standards">Git Commit Standards</a></h2>
<h3 id="commit-message-format"><a class="header" href="#commit-message-format">Commit Message Format</a></h3>
<p>Follow <a href="https://www.conventionalcommits.org/">Conventional Commits</a>:</p>
<pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;

&lt;body&gt;

&lt;footer&gt;
</code></pre>
<p><strong>Types</strong>:</p>
<ul>
<li><code>feat</code>: New feature</li>
<li><code>fix</code>: Bug fix</li>
<li><code>docs</code>: Documentation only</li>
<li><code>style</code>: Formatting, missing semicolons, etc.</li>
<li><code>refactor</code>: Code restructuring without feature change</li>
<li><code>perf</code>: Performance improvement</li>
<li><code>test</code>: Adding or updating tests</li>
<li><code>chore</code>: Build process, dependencies, etc.</li>
</ul>
<p><strong>Examples</strong>:</p>
<pre><code>feat(orchestrator): add support for parallel task execution

Implement asyncio.gather() for executing multiple independent
subtasks concurrently. This reduces overall task completion time
by 40% for tasks with multiple independent steps.

Closes #123
</code></pre>
<pre><code>fix(reflex): handle edge case in PII detection

Email regex was not matching emails with plus addressing
(user+tag@domain.com). Updated pattern to support RFC 5322.

Fixes #456
</code></pre>
<h3 id="branch-naming"><a class="header" href="#branch-naming">Branch Naming</a></h3>
<ul>
<li>Feature: <code>feature/&lt;issue-id&gt;-&lt;short-description&gt;</code></li>
<li>Bug fix: <code>fix/&lt;issue-id&gt;-&lt;short-description&gt;</code></li>
<li>Hotfix: <code>hotfix/&lt;issue-id&gt;-&lt;short-description&gt;</code></li>
</ul>
<p>Examples:</p>
<ul>
<li><code>feature/123-parallel-execution</code></li>
<li><code>fix/456-pii-email-detection</code></li>
<li><code>hotfix/789-critical-memory-leak</code></li>
</ul>
<hr />
<h2 id="automated-enforcement"><a class="header" href="#automated-enforcement">Automated Enforcement</a></h2>
<h3 id="pre-commit-hooks"><a class="header" href="#pre-commit-hooks">Pre-commit Hooks</a></h3>
<p>Install pre-commit hooks:</p>
<pre><code class="language-bash"># Install pre-commit
pip install pre-commit

# Install hooks
pre-commit install

# Run manually
pre-commit run --all-files
</code></pre>
<h3 id="cicd-checks"><a class="header" href="#cicd-checks">CI/CD Checks</a></h3>
<p><strong>.github/workflows/quality.yml</strong>:</p>
<pre><code class="language-yaml">name: Code Quality

on: [push, pull_request]

jobs:
  python-quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install black isort ruff mypy pytest pytest-cov
          pip install -r requirements.txt

      - name: Check formatting (black)
        run: black --check .

      - name: Check import sorting (isort)
        run: isort --check-only .

      - name: Lint (ruff)
        run: ruff check .

      - name: Type check (mypy)
        run: mypy octollm/

      - name: Run tests
        run: pytest --cov=octollm --cov-report=xml

      - name: Upload coverage
        uses: codecov/codecov-action@v3

  rust-quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          components: rustfmt, clippy

      - name: Check formatting
        run: cargo fmt --check

      - name: Lint
        run: cargo clippy -- -D warnings

      - name: Run tests
        run: cargo test
</code></pre>
<h3 id="ide-configuration"><a class="header" href="#ide-configuration">IDE Configuration</a></h3>
<p><strong>VS Code</strong> (<code>.vscode/settings.json</code>):</p>
<pre><code class="language-json">{
  "python.linting.enabled": true,
  "python.linting.ruffEnabled": true,
  "python.linting.mypyEnabled": true,
  "python.formatting.provider": "black",
  "editor.formatOnSave": true,
  "editor.rulers": [100],
  "[python]": {
    "editor.codeActionsOnSave": {
      "source.organizeImports": true
    }
  },
  "rust-analyzer.checkOnSave.command": "clippy"
}
</code></pre>
<hr />
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li><a href="https://peps.python.org/pep-0008/">PEP 8 -- Style Guide for Python Code</a></li>
<li><a href="https://peps.python.org/pep-0257/">PEP 257 -- Docstring Conventions</a></li>
<li><a href="https://doc.rust-lang.org/style-guide/">The Rust Style Guide</a></li>
<li><a href="https://www.conventionalcommits.org/">Conventional Commits</a></li>
<li><a href="https://google.github.io/styleguide/pyguide.html">Google Python Style Guide</a></li>
</ul>
<hr />
<p><strong>Last Review</strong>: 2025-11-10
<strong>Next Review</strong>: 2026-02-10 (Quarterly)
<strong>Owner</strong>: Engineering Team</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../engineering/code-review.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../engineering/error-handling.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../engineering/code-review.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../engineering/error-handling.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
